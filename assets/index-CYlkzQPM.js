var F=Object.defineProperty;var N=(A,d,t)=>d in A?F(A,d,{enumerable:!0,configurable:!0,writable:!0,value:t}):A[d]=t;var r=(A,d,t)=>N(A,typeof d!="symbol"?d+"":d,t);import{P as k}from"./phaser-0RJB29YE.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&e(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();class X extends k.Scene{constructor(){super("BootScene")}preload(){}create(){const d=this.cameras.main.width,t=this.cameras.main.height;this.add.text(d/2,t/2,"Loading...",{font:"20px monospace",color:"#ffffff"}).setOrigin(.5,.5),this.scene.start("MainScene")}}const M=class M extends k.Scene{constructor(){super("MainScene");r(this,"character");r(this,"skillIcons",[]);r(this,"gameBounds");r(this,"boundsBorder");r(this,"background");r(this,"gameAreaContainer");r(this,"revealMask")}create(){this.cameras.main.setBackgroundColor("#111111");const t=this.cameras.main.width,e=this.cameras.main.height;this.createBackground(t,e),this.gameBounds=this.registry.get("gameBounds"),this.gameBounds||(this.gameBounds={x:0,y:0,width:t,height:e}),this.gameAreaContainer=this.add.container(0,0),this.drawGameBorder();const s=this.gameBounds.height/8;this.character=this.add.graphics();const i=this.gameBounds.x+this.gameBounds.width/2,o=this.gameBounds.y+this.gameBounds.height/2;this.drawCharacter(i,o,s),this.createSkillBar(),this.gameAreaContainer.add([this.boundsBorder,this.character,...this.skillIcons]),this.revealMask=this.make.graphics({x:0,y:0});const h=this.revealMask.createGeometryMask();this.gameAreaContainer.setMask(h),this.registry.events.on("reveal-update",this.updateRevealMask,this),this.registry.events.on("reveal-complete",this.onRevealComplete,this)}updateRevealMask(t){this.revealMask&&(this.revealMask.clear(),this.revealMask.fillStyle(16777215),this.revealMask.fillCircle(t.x,t.y,t.radius))}onRevealComplete(){this.gameAreaContainer.clearMask(!0),this.revealMask.destroy(),this.registry.events.off("reveal-update",this.updateRevealMask,this),this.registry.events.off("reveal-complete",this.onRevealComplete,this)}createBackground(t,e){this.background=this.add.image(t/2,e/2,"background");const s=t/this.background.width,i=e/this.background.height,o=Math.max(s,i);this.background.setScale(o)}drawGameBorder(){this.boundsBorder=this.add.rectangle(this.gameBounds.x+this.gameBounds.width/2,this.gameBounds.y+this.gameBounds.height/2,this.gameBounds.width,this.gameBounds.height,0),this.boundsBorder.setStrokeStyle(2,4473924)}createSkillBar(){const t=this.gameBounds,e=Math.min(1,t.width/M.BASE_WIDTH),s=Math.max(.4,e),i=Math.floor(M.BASE_ICON_SIZE*s),o=Math.floor(M.BASE_ICON_GAP*s),h=Math.floor(M.BASE_GROUP_GAP*s),l=Math.floor(M.BASE_BOTTOM_MARGIN*s),g=Math.max(1,Math.floor(2*s)),w=M.ACTIVE_SKILLS,x=M.PASSIVE_SKILLS,a=w*i+(w-1)*o,y=x*i+(x-1)*o,p=a+h+y,u=t.x+(t.width-p)/2+i/2,n=t.y+t.height-i/2-l;for(let f=0;f<w;f++){const c=u+f*(i+o),m=this.add.rectangle(c,n,i,i);m.setStrokeStyle(g,16777215),m.setFillStyle(0,0),this.skillIcons.push(m)}const S=u+a+h;for(let f=0;f<x;f++){const c=S+f*(i+o),m=this.add.rectangle(c,n,i,i);m.setStrokeStyle(g,16777215),m.setFillStyle(0,0),this.skillIcons.push(m)}}drawCharacter(t,e,s){this.character.clear(),this.character.fillStyle(4491519),this.character.fillCircle(t,e-s*.2,s*.3),this.character.fillStyle(16764074),this.character.fillCircle(t,e-s*.5,s*.2),this.character.fillStyle(0),this.character.fillCircle(t-s*.08,e-s*.52,s*.04),this.character.fillCircle(t+s*.08,e-s*.52,s*.04)}};r(M,"BASE_ICON_SIZE",100),r(M,"BASE_ICON_GAP",10),r(M,"BASE_GROUP_GAP",30),r(M,"BASE_BOTTOM_MARGIN",20),r(M,"ACTIVE_SKILLS",4),r(M,"PASSIVE_SKILLS",3),r(M,"BASE_WIDTH",1920);let T=M;const _=7,D={0:{width:5,pixels:[" ### ","#   #","#  ##","# # #","##  #","#   #"," ### "]},1:{width:3,pixels:[" # ","## "," # "," # "," # "," # ","###"]},2:{width:5,pixels:[" ### ","#   #","    #","  ## "," #   ","#    ","#####"]},3:{width:5,pixels:[" ### ","#   #","    #","  ## ","    #","#   #"," ### "]},4:{width:5,pixels:["#   #","#   #","#   #","#####","    #","    #","    #"]},5:{width:5,pixels:["#####","#    ","#    ","#### ","    #","#   #"," ### "]},6:{width:5,pixels:[" ### ","#    ","#    ","#### ","#   #","#   #"," ### "]},7:{width:5,pixels:["#####","    #","   # ","  #  ","  #  ","  #  ","  #  "]},8:{width:5,pixels:[" ### ","#   #","#   #"," ### ","#   #","#   #"," ### "]},9:{width:5,pixels:[" ### ","#   #","#   #"," ####","    #","    #"," ### "]},A:{width:5,pixels:[" ### ","#   #","#   #","#####","#   #","#   #","#   #"]},D:{width:5,pixels:["#### ","#   #","#   #","#   #","#   #","#   #","#### "]},E:{width:4,pixels:["####","#   ","#   ","### ","#   ","#   ","####"]},G:{width:5,pixels:[" ### ","#    ","#    ","# ###","#   #","#   #"," ### "]},I:{width:3,pixels:["###"," # "," # "," # "," # "," # ","###"]},L:{width:4,pixels:["#   ","#   ","#   ","#   ","#   ","#   ","####"]},N:{width:5,pixels:["#   #","##  #","# # #","#  ##","#   #","#   #","#   #"]},O:{width:5,pixels:[" ### ","#   #","#   #","#   #","#   #","#   #"," ### "]},P:{width:4,pixels:["### ","#  #","#  #","### ","#   ","#   ","#   "]},R:{width:4,pixels:["### ","#  #","#  #","### ","# # ","#  #","#  #"]},S:{width:4,pixels:[" ###","#   ","#   "," ## ","   #","   #","### "]},T:{width:5,pixels:["#####","  #  ","  #  ","  #  ","  #  ","  #  ","  #  "]},"%":{width:5,pixels:["##  #","## # ","  #  "," #   "," # ##","#  ##","   ##"]}," ":{width:3,pixels:["   ","   ","   ","   ","   ","   ","   "]}},V={charHeight:_,chars:D};class Y{constructor(){r(this,"font");this.font=V}textToPixels(d,t,e){const s=[],i=d.letterSpacing??1,o=d.color.replace("#",""),h=parseInt(o.substring(0,2),16),l=parseInt(o.substring(2,4),16),g=parseInt(o.substring(4,6),16),w=h<<16|l<<8|g;let x=0;const a=d.text.toUpperCase().split("");for(let f=0;f<a.length;f++){const c=this.font.chars[a[f]];c&&(x+=c.width,f<a.length-1&&(x+=i))}const y=Math.floor(t*d.position.x),p=Math.floor(e*d.position.y),u=y-Math.floor(x/2),n=p-Math.floor(this.font.charHeight/2);let S=u;for(const f of a){const c=this.font.chars[f];if(c){for(let m=0;m<c.pixels.length;m++){const I=c.pixels[m];for(let v=0;v<I.length;v++)if(I[v]==="#"){const C=S+v,B=n+m;C>=0&&C<t&&B>=0&&B<e&&s.push({gridX:C,gridY:B,color:w})}}S+=c.width+i}}return s}processConfig(d,t,e){const s=new Map;for(const i of d.texts){const o=this.textToPixels(i,t,e);s.set(i.id,o)}return s}}const $=[{id:"title",text:"PRESS TO START",letterSpacing:2,position:{x:.5,y:.5},color:"#ffffff"}],U={texts:$},E=class E extends k.Scene{constructor(){super("GridScene");r(this,"cells",[]);r(this,"cols",0);r(this,"rows",0);r(this,"cellWidth",10);r(this,"cellHeight",10);r(this,"gap",1);r(this,"isAnimating",!1);r(this,"isReady",!1);r(this,"textRenderer");r(this,"textPixels",new Map);r(this,"cursorGlowRadius",4);r(this,"glowPhase",0);r(this,"textBreathPhase",0);r(this,"isLoading",!0);r(this,"loadingCells",new Set);r(this,"backgroundImage");this.textRenderer=new Y}preload(){this.load.image("background","background.png"),this.load.on("progress",t=>{this.updateLoadingProgress(Math.floor(t*100))})}create(){this.cameras.main.setBackgroundColor("rgba(0,0,0,0)"),this.createBackground(),this.calculateGridSize(),this.createGrid(),this.showLoadingText(0),this.startEntryAnimation(),this.preloadGameAssets(),this.input.on("pointerdown",t=>{if(!this.isReady||this.isAnimating)return;const e=Math.floor(t.x/(this.cellWidth+this.gap)),s=Math.floor(t.y/(this.cellHeight+this.gap));this.startExitAnimation(e,s)}),this.input.on("pointermove",t=>{!this.isReady||this.isAnimating||this.updateCursorGlow(t.x,t.y)})}update(t,e){if(!this.isReady||this.isAnimating)return;this.glowPhase+=e*.002,this.textBreathPhase+=e*.004;const s=this.input.activePointer;s&&this.updateCursorGlow(s.x,s.y),this.updateTextBreath()}updateTextBreath(){const t=.5+.5*Math.sin(this.textBreathPhase),e=Math.floor(204+51*t),s=e<<16|e<<8|e,i=.5+.5*Math.sin(this.textBreathPhase*3),o=t>.6?i*.8:0,h=new Set;this.cells.forEach(l=>{l.isText&&h.add(`${l.x},${l.y}`)}),this.cells.forEach(l=>{if(l.isText)l.graphics.setFillStyle(s),l.graphics.setAlpha(.95);else{const g=`${l.x-1},${l.y-1}`;h.has(g)&&o>0&&(l.graphics.setFillStyle(8939263),l.graphics.setAlpha(o))}})}updateCursorGlow(t,e){const s=Math.floor(t/(this.cellWidth+this.gap)),i=Math.floor(e/(this.cellHeight+this.gap)),o=.3+.7*(.5+.5*Math.sin(this.glowPhase));this.cells.forEach(h=>{const l=h.x-s,g=h.y-i,w=Math.sqrt(l*l+g*g);if(w<=this.cursorGlowRadius){const a=(1-w/this.cursorGlowRadius)*o,y=h.originalColor>>16&255,p=h.originalColor>>8&255,u=h.originalColor&255,n=Math.min(255,Math.floor(y+(255-y)*a)),S=Math.min(255,Math.floor(p+(255-p)*a)),f=Math.min(255,Math.floor(u+(255-u)*a)),c=n<<16|S<<8|f;h.graphics.setFillStyle(c)}else h.graphics.setFillStyle(h.originalColor)})}createBackground(){const t=this.cameras.main.width,e=this.cameras.main.height;this.backgroundImage=this.add.image(t/2,e/2,"background");const s=t/this.backgroundImage.width,i=e/this.backgroundImage.height,o=Math.max(s,i);this.backgroundImage.setScale(o),this.backgroundImage.setDepth(-1)}showLoadingText(t){this.loadingCells.forEach(i=>{this.cells[i]&&(this.cells[i].originalColor=2236962,this.cells[i].isText=!1,this.cells[i].graphics.setFillStyle(2236962),this.cells[i].graphics.setAlpha(.2))}),this.loadingCells.clear();const e=`LOADING ${t}%`;this.textRenderer.textToPixels({id:"loading",text:e,letterSpacing:2,position:{x:.5,y:.5},color:"#ffffff"},this.cols,this.rows).forEach(i=>{const o=i.gridY*this.cols+i.gridX;this.cells[o]&&(this.cells[o].originalColor=i.color,this.cells[o].isText=!0,this.cells[o].graphics.setFillStyle(i.color),this.cells[o].graphics.setAlpha(.95),this.loadingCells.add(o))})}updateLoadingProgress(t){this.isLoading&&this.showLoadingText(t)}preloadGameAssets(){let t=0;const e=this.time.addEvent({delay:50,callback:()=>{t+=Math.random()*15,t>=100&&(t=100,e.destroy(),this.onLoadingComplete()),this.showLoadingText(Math.floor(t))},loop:!0})}onLoadingComplete(){this.isLoading=!1,this.time.delayedCall(500,()=>{this.cells.forEach(t=>{t.originalColor=2236962,t.isText=!1,t.graphics.setFillStyle(2236962),t.graphics.setAlpha(.2)}),this.loadingCells.clear(),this.time.delayedCall(300,()=>{this.processTextConfig(),this.textPixels.forEach(t=>{t.forEach(e=>{const s=e.gridY*this.cols+e.gridX;this.cells[s]&&(this.cells[s].graphics.setFillStyle(e.color),this.cells[s].graphics.setAlpha(.95))})}),this.isAnimating||(this.isReady=!0)})})}calculateGridSize(){const t=this.cameras.main.width,e=this.cameras.main.height,s=Math.min(1,t/E.BASE_WIDTH),i=Math.max(E.MIN_CELL_SIZE,Math.floor(E.BASE_CELL_SIZE*s));this.gap=1,this.cellWidth=i,this.cellHeight=i,this.cols=Math.ceil((t+this.gap)/(i+this.gap)),this.rows=Math.ceil((e+this.gap)/(i+this.gap));const o=.05,h=t*(1-o*2),l=e*(1-o*2),g=16/9,w=h/l;let x,a;w>g?(a=l,x=l*g):(x=h,a=h/g);const y=(t-x)/2,p=(e-a)/2;this.registry.set("gameBounds",{x:y,y:p,width:x,height:a}),console.log(`Grid: ${this.cols}x${this.rows}, cellSize: ${i}, gameBounds: ${x.toFixed(0)}x${a.toFixed(0)}`)}createGrid(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++){const s=e*(this.cellWidth+this.gap)+this.cellWidth/2,i=t*(this.cellHeight+this.gap)+this.cellHeight/2,o=this.add.rectangle(s,i,this.cellWidth,this.cellHeight,2236962);o.setAlpha(0),this.cells.push({x:e,y:t,graphics:o,delay:0,originalColor:2236962,isText:!1})}}processTextConfig(){this.textPixels=this.textRenderer.processConfig(U,this.cols,this.rows),this.textPixels.forEach(t=>{t.forEach(e=>{const s=e.gridY*this.cols+e.gridX;this.cells[s]&&(this.cells[s].originalColor=e.color,this.cells[s].isText=!0)})})}startEntryAnimation(){this.isAnimating=!0;const t=new Set;for(let n=0;n<this.cells.length;n++)t.add(n);const e=20,s=50,i=10,h=Math.floor(200/i),l=3e3;let g=0,w=!1;const x=(n,S)=>S*this.cols+n,a=n=>({x:n%this.cols,y:Math.floor(n/this.cols)}),y=n=>{const S=this.cells[n];S.graphics.setAlpha(1),S.graphics.setFillStyle(16777215),this.tweens.add({targets:S.graphics,fillColor:{from:16777215,to:S.originalColor},alpha:{from:1,to:.2},duration:80,ease:"Linear"})},p=n=>{const{x:S,y:f}=a(n),c=h,m=[];for(let C=0;C<=c;C++)m[C]=[];for(let C=-c;C<=c;C++)for(let B=-c;B<=c;B++){const b=S+B,L=f+C;if(b>=0&&b<this.cols&&L>=0&&L<this.rows){const O=Math.sqrt(B*B+C*C),R=Math.floor(O);if(R<=c){const H=x(b,L);m[R].push(H)}}}let I=0;const v=()=>{I>c||(m[I].forEach(C=>{t.has(C)&&(t.delete(C),y(C))}),I++,I<=c&&this.time.delayedCall(i,v))};v()},u=()=>{if(w)return;if(g>=l||t.size===0){this.finishEntry(t),w=!0;return}const n=Array.from(t),S=Math.min(e,n.length);for(let f=0;f<S&&n.length!==0;f++){const c=Math.floor(Math.random()*n.length),m=n[c];n.splice(c,1),t.has(m)&&p(m)}g+=s,t.size>0&&g<l?this.time.delayedCall(s,u):w||(this.finishEntry(t),w=!0)};u()}finishEntry(t){t.forEach(e=>{const s=this.cells[e];s.graphics.setAlpha(.2),s.graphics.setFillStyle(s.originalColor)}),this.time.delayedCall(100,()=>{this.isAnimating=!1,this.isLoading||(this.isReady=!0)})}startExitAnimation(t,e){this.isAnimating=!0;const s=this.cameras.main.width,i=this.cameras.main.height;this.scene.launch("MainScene"),this.scene.bringToTop("GridScene");const o=t*(this.cellWidth+this.gap)+this.cellWidth/2,h=e*(this.cellHeight+this.gap)+this.cellHeight/2;this.registry.events.emit("reveal-update",{x:o,y:h,radius:0}),this.cells.forEach(a=>{a.graphics.setFillStyle(1118481),a.graphics.setAlpha(1)}),this.backgroundImage.setVisible(!1);const l=5;let g=0;this.cells.forEach(a=>{const y=a.x-t,p=a.y-e,u=Math.sqrt(y*y+p*p);a.delay=Math.floor(u*l),a.delay>g&&(g=a.delay)});const w=Math.sqrt(Math.max(o,s-o)**2+Math.max(h,i-h)**2)+50,x=g+150;this.tweens.addCounter({from:0,to:w,duration:x,ease:"Linear",onUpdate:a=>{const y=a.getValue()??0;this.registry.events.emit("reveal-update",{x:o,y:h,radius:y})}}),this.cells.forEach(a=>{this.time.delayedCall(a.delay,()=>{this.tweens.addCounter({from:0,to:100,duration:150,ease:"Power1",onUpdate:y=>{const p=y.getValue()??0;let u;p<20?u=16777215:p<40?u=16776960:p<60?u=16746496:p<80?u=16720384:u=4456448,a.graphics.setFillStyle(u),a.graphics.setAlpha(1-p/100)},onComplete:()=>{a.graphics.setVisible(!1)}})})}),this.time.delayedCall(g+200,()=>{this.registry.events.emit("reveal-complete"),this.scene.stop("GridScene")})}};r(E,"BASE_CELL_SIZE",10),r(E,"MIN_CELL_SIZE",4),r(E,"BASE_WIDTH",1920);let G=E,W=null;function Z(){return window.innerWidth>window.innerHeight}function K(){if(W)return;const A={type:k.AUTO,width:window.innerWidth,height:window.innerHeight,parent:"app",backgroundColor:"#111111",scale:{mode:k.Scale.RESIZE,autoCenter:k.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scene:[G,X,T]};W=new k.Game(A)}function P(){(window.innerWidth>900||Z())&&K()}P();window.addEventListener("resize",P);window.addEventListener("orientationchange",()=>{setTimeout(P,100)});
