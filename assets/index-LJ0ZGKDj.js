var X=Object.defineProperty;var H=(g,n,t)=>n in g?X(g,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):g[n]=t;var f=(g,n,t)=>H(g,typeof n!="symbol"?n+"":n,t);import{P as C}from"./phaser-0RJB29YE.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(e){if(e.ep)return;e.ep=!0;const o=t(e);fetch(e.href,o)}})();class Y extends C.Scene{constructor(){super("BootScene")}preload(){}create(){const n=this.cameras.main.width,t=this.cameras.main.height;this.add.text(n/2,t/2,"Loading...",{font:"20px monospace",color:"#ffffff"}).setOrigin(.5,.5),this.scene.start("MainScene")}}class F extends C.Scene{constructor(){super("MainScene")}create(){const n=this.cameras.main.width,t=this.cameras.main.height;this.add.text(n/2,t/2,`DDT Web Game
Phaser 3 + Vite`,{font:"40px Arial",color:"#ffffff",align:"center"}).setOrigin(.5,.5);const s=this.add.circle(n/2,t/2+100,50,16711680);s.setInteractive(),s.on("pointerdown",()=>{s.setFillStyle(65280)}),s.on("pointerup",()=>{s.setFillStyle(16711680)})}}const D=7,B={A:{width:5,pixels:[" ### ","#   #","#   #","#####","#   #","#   #","#   #"]},E:{width:4,pixels:["####","#   ","#   ","### ","#   ","#   ","####"]},O:{width:5,pixels:[" ### ","#   #","#   #","#   #","#   #","#   #"," ### "]},P:{width:4,pixels:["### ","#  #","#  #","### ","#   ","#   ","#   "]},R:{width:4,pixels:["### ","#  #","#  #","### ","# # ","#  #","#  #"]},S:{width:4,pixels:[" ###","#   ","#   "," ## ","   #","   #","### "]},T:{width:5,pixels:["#####","  #  ","  #  ","  #  ","  #  ","  #  ","  #  "]}," ":{width:3,pixels:["   ","   ","   ","   ","   ","   ","   "]}},N={charHeight:D,chars:B};class U{constructor(){f(this,"font");this.font=N}textToPixels(n,t,s){const e=[],o=n.letterSpacing??1,i=n.color.replace("#",""),d=parseInt(i.substring(0,2),16),h=parseInt(i.substring(2,4),16),a=parseInt(i.substring(4,6),16),x=d<<16|h<<8|a;let A=0;const E=n.text.toUpperCase().split("");for(let u=0;u<E.length;u++){const c=this.font.chars[E[u]];c&&(A+=c.width,u<E.length-1&&(A+=o))}const T=Math.floor(t*n.position.x),G=Math.floor(s*n.position.y),z=T-Math.floor(A/2),r=G-Math.floor(this.font.charHeight/2);let p=z;for(const u of E){const c=this.font.chars[u];if(c){for(let m=0;m<c.pixels.length;m++){const y=c.pixels[m];for(let S=0;S<y.length;S++)if(y[S]==="#"){const l=p+S,w=r+m;l>=0&&l<t&&w>=0&&w<s&&e.push({gridX:l,gridY:w,color:x})}}p+=c.width+o}}return e}processConfig(n,t,s){const e=new Map;for(const o of n.texts){const i=this.textToPixels(o,t,s);e.set(o.id,i)}return e}}const $=[{id:"title",text:"PRESS TO START",letterSpacing:2,position:{x:.5,y:.5},color:"#ffffff"}],q={texts:$},M=class M extends C.Scene{constructor(){super("GridScene");f(this,"cells",[]);f(this,"cols",0);f(this,"rows",0);f(this,"cellSize",10);f(this,"gap",1);f(this,"offsetX",0);f(this,"offsetY",0);f(this,"isAnimating",!1);f(this,"textRenderer");f(this,"textPixels",new Map);this.textRenderer=new U}create(){this.calculateGridSize(),this.createGrid(),this.processTextConfig(),this.startEntryAnimation(),this.input.on("pointerdown",t=>{if(this.isAnimating)return;const s=Math.floor((t.x-this.offsetX)/(this.cellSize+this.gap)),e=Math.floor((t.y-this.offsetY)/(this.cellSize+this.gap));this.startExitAnimation(s,e)})}calculateGridSize(){const t=this.cameras.main.width,s=this.cameras.main.height;this.cols=M.TARGET_COLS,this.rows=M.TARGET_ROWS;const e=t/this.cols,o=s/this.rows,i=Math.min(e,o);this.cellSize=Math.floor(i*.9),this.gap=Math.max(1,Math.floor(i*.1)),this.cellSize<2&&(this.cellSize=2,this.gap=1),console.log(`Grid: ${this.cols}x${this.rows}, cellSize: ${this.cellSize}, gap: ${this.gap}`)}createGrid(){const t=this.cameras.main.width,s=this.cameras.main.height,e=this.cols*(this.cellSize+this.gap)-this.gap,o=this.rows*(this.cellSize+this.gap)-this.gap;this.offsetX=(t-e)/2,this.offsetY=(s-o)/2;for(let i=0;i<this.rows;i++)for(let d=0;d<this.cols;d++){const h=this.offsetX+d*(this.cellSize+this.gap)+this.cellSize/2,a=this.offsetY+i*(this.cellSize+this.gap)+this.cellSize/2,x=this.add.rectangle(h,a,this.cellSize,this.cellSize,2236962);x.setAlpha(0),this.cells.push({x:d,y:i,graphics:x,delay:0,originalColor:2236962})}}processTextConfig(){this.textPixels=this.textRenderer.processConfig(q,this.cols,this.rows),this.textPixels.forEach(t=>{t.forEach(s=>{const e=s.gridY*this.cols+s.gridX;this.cells[e]&&(this.cells[e].originalColor=s.color)})})}startEntryAnimation(){this.isAnimating=!0;const t=new Set;for(let r=0;r<this.cells.length;r++)t.add(r);const s=20,e=50,o=10,d=Math.floor(200/o),h=3e3;let a=0,x=!1;const A=(r,p)=>p*this.cols+r,E=r=>({x:r%this.cols,y:Math.floor(r/this.cols)}),T=r=>{const p=this.cells[r];p.graphics.setAlpha(1),p.graphics.setFillStyle(16777215),this.tweens.add({targets:p.graphics,fillColor:{from:16777215,to:p.originalColor},duration:80,ease:"Linear"})},G=r=>{const{x:p,y:u}=E(r),c=d,m=[];for(let l=0;l<=c;l++)m[l]=[];for(let l=-c;l<=c;l++)for(let w=-c;w<=c;w++){const O=p+w,P=u+l;if(O>=0&&O<this.cols&&P>=0&&P<this.rows){const b=Math.sqrt(w*w+l*l),L=Math.floor(b);if(L<=c){const W=A(O,P);m[L].push(W)}}}let y=0;const S=()=>{y>c||(m[y].forEach(l=>{t.has(l)&&(t.delete(l),T(l))}),y++,y<=c&&this.time.delayedCall(o,S))};S()},z=()=>{if(x)return;if(a>=h||t.size===0){this.finishEntry(t),x=!0;return}const r=Array.from(t),p=Math.min(s,r.length);for(let u=0;u<p&&r.length!==0;u++){const c=Math.floor(Math.random()*r.length),m=r[c];r.splice(c,1),t.has(m)&&G(m)}a+=e,t.size>0&&a<h?this.time.delayedCall(e,z):x||(this.finishEntry(t),x=!0)};z()}finishEntry(t){t.forEach(s=>{const e=this.cells[s];e.graphics.setAlpha(1),e.graphics.setFillStyle(e.originalColor)}),this.time.delayedCall(100,()=>{this.isAnimating=!1})}startExitAnimation(t,s){this.isAnimating=!0;const e=5;let o=0;this.cells.forEach(i=>{const d=i.x-t,h=i.y-s,a=Math.sqrt(d*d+h*h);i.delay=Math.floor(a*e),i.delay>o&&(o=i.delay)}),this.cells.forEach(i=>{this.time.delayedCall(i.delay,()=>{this.tweens.addCounter({from:0,to:100,duration:150,ease:"Power1",onUpdate:d=>{const h=d.getValue()??0;let a;h<20?a=16777215:h<40?a=16776960:h<60?a=16746496:h<80?a=16720384:a=4456448,i.graphics.setFillStyle(a),i.graphics.setAlpha(1-h/100*.8)},onComplete:()=>{i.graphics.setAlpha(0)}})})}),this.time.delayedCall(o+200,()=>{this.scene.start("MainScene")})}};f(M,"TARGET_COLS",240),f(M,"TARGET_ROWS",135);let R=M,v=null;function V(){return window.innerWidth>window.innerHeight}function K(){if(v)return;const g={type:C.AUTO,width:window.innerWidth,height:window.innerHeight,parent:"app",backgroundColor:"#111111",scale:{mode:C.Scale.RESIZE,autoCenter:C.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scene:[R,Y,F]};v=new C.Game(g)}function I(){(window.innerWidth>900||V())&&K()}I();window.addEventListener("resize",I);window.addEventListener("orientationchange",()=>{setTimeout(I,100)});
