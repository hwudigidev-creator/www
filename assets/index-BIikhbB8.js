var W=Object.defineProperty;var R=(M,S,t)=>S in M?W(M,S,{enumerable:!0,configurable:!0,writable:!0,value:t}):M[S]=t;var o=(M,S,t)=>R(M,typeof S!="symbol"?S+"":S,t);import{P as y}from"./phaser-0RJB29YE.js";(function(){const S=document.createElement("link").relList;if(S&&S.supports&&S.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const i of e)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(e){const i={};return e.integrity&&(i.integrity=e.integrity),e.referrerPolicy&&(i.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?i.credentials="include":e.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(e){if(e.ep)return;e.ep=!0;const i=t(e);fetch(e.href,i)}})();class H extends y.Scene{constructor(){super("BootScene")}preload(){}create(){const S=this.cameras.main.width,t=this.cameras.main.height;this.add.text(S/2,t/2,"Loading...",{font:"20px monospace",color:"#ffffff"}).setOrigin(.5,.5),this.scene.start("MainScene")}}const B=class B extends y.Scene{constructor(){super("MainScene");o(this,"character");o(this,"skillIcons",[]);o(this,"gameBounds");o(this,"boundsBorder");o(this,"background");o(this,"gameAreaContainer");o(this,"revealMask");o(this,"mapWidth");o(this,"mapHeight");o(this,"characterX");o(this,"characterY");o(this,"characterSize");o(this,"isMoving",!1);o(this,"targetX");o(this,"targetY");o(this,"moveSpeed",400);o(this,"floorGrid");o(this,"worldContainer");o(this,"uiContainer");o(this,"cameraOffsetX",0);o(this,"cameraOffsetY",0);o(this,"cursors");o(this,"isKeyboardMoving",!1);o(this,"skillPanelContainer");o(this,"isPaused",!1);o(this,"skillOptions",[]);o(this,"skillCardBgs",[]);o(this,"selectedSkillIndex",0);o(this,"currentExp",0);o(this,"maxExp",100);o(this,"currentLevel",0);o(this,"expBarContainer");o(this,"expBarFill");o(this,"expBarFlowOffset",0);o(this,"levelText");o(this,"keyPlus");o(this,"keyMinus")}create(){this.cameras.main.setBackgroundColor("#111111");const t=this.cameras.main.width,s=this.cameras.main.height;if(this.gameBounds=this.registry.get("gameBounds"),!this.gameBounds){const r=t*.9,l=s*(1-.05*2),c=16/9,u=r/l;let n,d;u>c?(d=l,n=l*c):(n=r,d=r/c),this.gameBounds={x:(t-n)/2,y:(s-d)/2,width:n,height:d}}this.mapWidth=this.gameBounds.width*B.MAP_SCALE,this.mapHeight=this.gameBounds.height*B.MAP_SCALE,this.characterSize=this.gameBounds.height/8,this.characterX=this.mapWidth/2,this.characterY=this.mapHeight/2,this.createFullscreenBackground(t,s),this.gameAreaContainer=this.add.container(0,0),this.drawGameBorder(),this.worldContainer=this.add.container(this.gameBounds.x,this.gameBounds.y),this.floorGrid=this.add.graphics(),this.drawFloorGrid(),this.worldContainer.add(this.floorGrid),this.character=this.add.graphics(),this.drawCharacter(),this.worldContainer.add(this.character),this.gameAreaContainer.add([this.boundsBorder,this.worldContainer]);const e=this.make.graphics({x:0,y:0});e.fillStyle(16777215),e.fillRect(this.gameBounds.x,this.gameBounds.y,this.gameBounds.width,this.gameBounds.height);const i=e.createGeometryMask();this.worldContainer.setMask(i),this.uiContainer=this.add.container(0,0),this.createSkillBar(),this.revealMask=this.make.graphics({x:0,y:0});const a=this.revealMask.createGeometryMask();this.gameAreaContainer.setMask(a),this.uiContainer.setMask(a),this.registry.events.on("reveal-update",this.updateRevealMask,this),this.registry.events.on("reveal-complete",this.onRevealComplete,this),this.input.on("pointerdown",this.onPointerDown,this),this.input.keyboard&&(this.cursors={W:this.input.keyboard.addKey(y.Input.Keyboard.KeyCodes.W),A:this.input.keyboard.addKey(y.Input.Keyboard.KeyCodes.A),S:this.input.keyboard.addKey(y.Input.Keyboard.KeyCodes.S),D:this.input.keyboard.addKey(y.Input.Keyboard.KeyCodes.D)},this.keyPlus=this.input.keyboard.addKey(y.Input.Keyboard.KeyCodes.PLUS),this.keyMinus=this.input.keyboard.addKey(y.Input.Keyboard.KeyCodes.MINUS)),this.updateCamera(!0),this.createExpBar(),this.createSkillPanel(),this.showSkillPanel()}update(t,s){if(this.updateExpBarFlow(s),this.isPaused){this.handleSkillPanelInput();return}this.handleExpTestInput(),this.handleKeyboardInput(s),this.isMoving&&!this.isKeyboardMoving&&this.moveCharacter(s)}handleExpTestInput(){!this.keyPlus||!this.keyMinus||(y.Input.Keyboard.JustDown(this.keyPlus)&&this.addExp(10),y.Input.Keyboard.JustDown(this.keyMinus)&&this.addExp(-10))}addExp(t){this.currentExp+=t,this.currentExp<0&&(this.currentExp=0),this.currentExp>=this.maxExp&&this.levelUp(),this.drawExpBarFill()}levelUp(){this.currentLevel++,this.currentExp=0,this.levelText.setText(`Lv.${this.currentLevel}`),this.showSkillPanel(),this.drawExpBarFill()}handleSkillPanelInput(){this.cursors&&(y.Input.Keyboard.JustDown(this.cursors.A)&&this.setSelectedSkill(0),y.Input.Keyboard.JustDown(this.cursors.S)&&this.setSelectedSkill(1),y.Input.Keyboard.JustDown(this.cursors.D)&&this.setSelectedSkill(2),y.Input.Keyboard.JustDown(this.cursors.W)&&this.confirmSkillSelection())}setSelectedSkill(t){this.updateSkillCardStyle(this.selectedSkillIndex,!1),this.selectedSkillIndex=t,this.updateSkillCardStyle(this.selectedSkillIndex,!0)}updateSkillCardStyle(t,s){const e=this.skillCardBgs[t],i=this.skillOptions[t];!e||!i||(s?(e.setFillStyle(3355443),e.setStrokeStyle(3,16777215),this.tweens.add({targets:i,scaleX:1.05,scaleY:1.05,duration:100})):(e.setFillStyle(2236962),e.setStrokeStyle(2,6710886),this.tweens.add({targets:i,scaleX:1,scaleY:1,duration:100})))}confirmSkillSelection(){const t=[{name:"SKILL A"},{name:"SKILL B"},{name:"SKILL C"}];this.selectSkill(this.selectedSkillIndex,t[this.selectedSkillIndex].name)}handleKeyboardInput(t){if(!this.cursors)return;let s=0,e=0;if(this.cursors.W.isDown&&(e=-1),this.cursors.S.isDown&&(e=1),this.cursors.A.isDown&&(s=-1),this.cursors.D.isDown&&(s=1),s!==0||e!==0){if(this.isKeyboardMoving=!0,this.isMoving=!1,s!==0&&e!==0){const a=1/Math.sqrt(2);s*=a,e*=a}const i=this.moveSpeed*t/1e3;this.characterX+=s*i,this.characterY+=e*i,this.characterX=y.Math.Clamp(this.characterX,this.characterSize,this.mapWidth-this.characterSize),this.characterY=y.Math.Clamp(this.characterY,this.characterSize,this.mapHeight-this.characterSize),this.drawCharacter(),this.updateCamera()}else this.isKeyboardMoving=!1}onPointerDown(t){if(this.isPaused||t.x<this.gameBounds.x||t.x>this.gameBounds.x+this.gameBounds.width||t.y<this.gameBounds.y||t.y>this.gameBounds.y+this.gameBounds.height)return;const s=t.x-this.gameBounds.x,e=t.y-this.gameBounds.y,i=s+this.cameraOffsetX,a=e+this.cameraOffsetY;this.targetX=y.Math.Clamp(i,this.characterSize,this.mapWidth-this.characterSize),this.targetY=y.Math.Clamp(a,this.characterSize,this.mapHeight-this.characterSize),this.isMoving=!0}moveCharacter(t){const s=this.targetX-this.characterX,e=this.targetY-this.characterY,i=Math.sqrt(s*s+e*e);if(i<5)this.characterX=this.targetX,this.characterY=this.targetY,this.isMoving=!1;else{const a=this.moveSpeed*t/1e3;if(a>=i)this.characterX=this.targetX,this.characterY=this.targetY,this.isMoving=!1;else{const h=a/i;this.characterX+=s*h,this.characterY+=e*h}}this.drawCharacter(),this.updateCamera()}updateCamera(t=!1){const s=this.cameraOffsetX+this.gameBounds.width/2,e=this.cameraOffsetY+this.gameBounds.height/2,i=this.characterX-s,a=this.characterY-e,h=this.gameBounds.width*B.CAMERA_DEAD_ZONE,r=this.gameBounds.height*B.CAMERA_DEAD_ZONE;t?(this.cameraOffsetX=this.characterX-this.gameBounds.width/2,this.cameraOffsetY=this.characterY-this.gameBounds.height/2):(Math.abs(i)>h/2&&(i>0?this.cameraOffsetX+=i-h/2:this.cameraOffsetX+=i+h/2),Math.abs(a)>r/2&&(a>0?this.cameraOffsetY+=a-r/2:this.cameraOffsetY+=a+r/2)),this.cameraOffsetX=y.Math.Clamp(this.cameraOffsetX,0,this.mapWidth-this.gameBounds.width),this.cameraOffsetY=y.Math.Clamp(this.cameraOffsetY,0,this.mapHeight-this.gameBounds.height),this.worldContainer.setPosition(this.gameBounds.x-this.cameraOffsetX,this.gameBounds.y-this.cameraOffsetY)}updateRevealMask(t){this.revealMask&&(this.revealMask.clear(),this.revealMask.fillStyle(16777215),this.revealMask.fillCircle(t.x,t.y,t.radius))}onRevealComplete(){this.gameAreaContainer.clearMask(!0),this.uiContainer.clearMask(!0),this.revealMask.destroy(),this.registry.events.off("reveal-update",this.updateRevealMask,this),this.registry.events.off("reveal-complete",this.onRevealComplete,this)}createFullscreenBackground(t,s){this.background=this.add.image(t/2,s/2,"background");const e=t/this.background.width,i=s/this.background.height,a=Math.max(e,i);this.background.setScale(a)}drawGameBorder(){this.boundsBorder=this.add.rectangle(this.gameBounds.x+this.gameBounds.width/2,this.gameBounds.y+this.gameBounds.height/2,this.gameBounds.width,this.gameBounds.height,0),this.boundsBorder.setStrokeStyle(2,4473924)}createExpBar(){this.expBarContainer=this.add.container(0,0),this.expBarContainer.setDepth(100);const t=this.gameBounds.height*.01,s=this.gameBounds.width,e=this.gameBounds.x,i=this.gameBounds.y+this.gameBounds.height-t,a=this.add.rectangle(e+s/2,i+t/2,s,t,0);this.expBarContainer.add(a),this.expBarFill=this.add.graphics(),this.expBarContainer.add(this.expBarFill),this.drawExpBarFill();const h=Math.floor(this.gameBounds.height*.03);this.levelText=this.add.text(this.gameBounds.x+10,i-h-5,`Lv.${this.currentLevel}`,{fontFamily:"monospace",fontSize:`${h}px`,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:3}),this.levelText.setOrigin(0,1),this.expBarContainer.add(this.levelText)}drawExpBarFill(){this.expBarFill.clear();const t=this.gameBounds.height*.01,s=this.gameBounds.width,e=this.gameBounds.x,i=this.gameBounds.y+this.gameBounds.height-t,a=this.currentExp/this.maxExp,h=s*a;if(h<=0)return;const r=Math.ceil(h/2)+1;for(let l=0;l<r;l++){const c=e+l*2;if(c>=e+h)break;const u=(c-e)/s,n=this.expBarFlowOffset,d=(u+n)%1,m=(Math.sin(d*Math.PI*2-Math.PI/2)+1)/2,w=Math.floor(68+68*m),g=Math.floor(136-68*m),p=w<<16|g<<8|255;this.expBarFill.fillStyle(p,1);const f=Math.min(2,e+h-c);this.expBarFill.fillRect(c,i,f,t)}this.expBarFill.fillStyle(16777215,.2),this.expBarFill.fillRect(e,i,h,t*.4)}updateExpBarFlow(t){this.expBarFlowOffset+=.1*t/1e3,this.expBarFlowOffset>=1&&(this.expBarFlowOffset-=1),this.drawExpBarFill()}drawFloorGrid(){this.floorGrid.clear();const t=this.gameBounds.height/10,s=Math.ceil(this.mapWidth/t),e=Math.ceil(this.mapHeight/t);for(let r=0;r<e;r++)for(let l=0;l<s;l++){const c=l*t,u=r*t;(r+l)%2===0?this.floorGrid.fillStyle(3355443,1):this.floorGrid.fillStyle(4473924,1),this.floorGrid.fillRect(c,u,t,t),this.floorGrid.lineStyle(1,5592405,.5),this.floorGrid.strokeRect(c,u,t,t)}this.floorGrid.lineStyle(4,16729156,1),this.floorGrid.strokeRect(0,0,this.mapWidth,this.mapHeight),this.floorGrid.lineStyle(2,16776960,1);const i=this.mapWidth/2,a=this.mapHeight/2,h=t;this.floorGrid.strokeRect(i-h/2,a-h/2,h,h);for(let r=0;r<e;r+=5)for(let l=0;l<s;l+=5){const c=l*t+t/2,u=r*t+t/2;this.floorGrid.fillStyle(6710886,1),this.floorGrid.fillCircle(c,u,4)}}createSkillBar(){const t=this.gameBounds,s=Math.min(1,t.width/B.BASE_WIDTH),e=Math.max(.4,s),i=Math.floor(B.BASE_ICON_SIZE*e),a=Math.floor(B.BASE_ICON_GAP*e),h=Math.floor(B.BASE_GROUP_GAP*e),r=Math.floor(B.BASE_BOTTOM_MARGIN*e),l=Math.max(1,Math.floor(2*e)),c=B.ACTIVE_SKILLS,u=B.PASSIVE_SKILLS,n=c*i+(c-1)*a,d=u*i+(u-1)*a,m=n+h+d,w=t.x+(t.width-m)/2+i/2,g=t.y+t.height-i/2-r;for(let p=0;p<c;p++){const f=w+p*(i+a),x=this.add.rectangle(f,g,i,i);x.setStrokeStyle(l,16777215),x.setFillStyle(0,0),this.skillIcons.push(x),this.uiContainer.add(x)}const C=w+n+h;for(let p=0;p<u;p++){const f=C+p*(i+a),x=this.add.rectangle(f,g,i,i);x.setStrokeStyle(l,16777215),x.setFillStyle(0,0),this.skillIcons.push(x),this.uiContainer.add(x)}}drawCharacter(){const t=this.characterX,s=this.characterY,e=this.characterSize;this.character.clear(),this.character.fillStyle(4491519),this.character.fillCircle(t,s-e*.2,e*.3),this.character.fillStyle(16764074),this.character.fillCircle(t,s-e*.5,e*.2),this.character.fillStyle(0),this.character.fillCircle(t-e*.08,s-e*.52,e*.04),this.character.fillCircle(t+e*.08,s-e*.52,e*.04)}createSkillPanel(){this.skillPanelContainer=this.add.container(0,0),this.skillPanelContainer.setVisible(!1),this.skillPanelContainer.setDepth(1e3);const t=this.add.rectangle(this.gameBounds.x+this.gameBounds.width/2,this.gameBounds.y+this.gameBounds.height/2,this.gameBounds.width,this.gameBounds.height,0,.8);t.setInteractive(),this.skillPanelContainer.add(t);const s=this.gameBounds.y+this.gameBounds.height*.12,e=this.add.text(this.gameBounds.x+this.gameBounds.width/2,s,"選擇技能",{fontFamily:"Microsoft JhengHei, PingFang TC, sans-serif",fontSize:`${Math.floor(this.gameBounds.height*.07)}px`,color:"#ffffff",fontStyle:"bold"});e.setOrigin(.5,.5),this.skillPanelContainer.add(e);const i=s+this.gameBounds.height*.06,a=this.add.text(this.gameBounds.x+this.gameBounds.width/2,i,"提升你的數位能力",{fontFamily:"Microsoft JhengHei, PingFang TC, sans-serif",fontSize:`${Math.floor(this.gameBounds.height*.025)}px`,color:"#aaaaaa"});a.setOrigin(.5,.5),this.skillPanelContainer.add(a),this.createSkillOptions();const h=this.gameBounds.y+this.gameBounds.height*.92,r=this.add.text(this.gameBounds.x+this.gameBounds.width/2,h,"點選或按 W 確定",{fontFamily:"Microsoft JhengHei, PingFang TC, sans-serif",fontSize:`${Math.floor(this.gameBounds.height*.022)}px`,color:"#666666"});r.setOrigin(.5,.5),this.skillPanelContainer.add(r)}createSkillOptions(){this.skillOptions.forEach(l=>l.destroy()),this.skillOptions=[],this.skillCardBgs=[];const t=this.gameBounds.width*.25,s=this.gameBounds.height*.5,e=this.gameBounds.width*.05,i=t*3+e*2,a=this.gameBounds.x+(this.gameBounds.width-i)/2+t/2,h=this.gameBounds.y+this.gameBounds.height*.55,r=[{name:"SKILL A",description:"Increase attack power by 10%",color:16737894,key:"A"},{name:"SKILL B",description:"Boost movement speed by 15%",color:6750054,key:"S"},{name:"SKILL C",description:"Restore 20 HP instantly",color:6711039,key:"D"}];for(let l=0;l<3;l++){const c=r[l],u=a+l*(t+e),n=this.add.container(u,h),d=this.add.rectangle(0,0,t,s,2236962);d.setStrokeStyle(2,6710886),n.add(d);const m=t*.5,w=-s*.2,g=this.add.rectangle(0,w,m,m,c.color,.3);g.setStrokeStyle(2,c.color),n.add(g);const C=this.add.text(0,s*.1,c.name,{fontFamily:"monospace",fontSize:`${Math.floor(s*.08)}px`,color:"#ffffff",fontStyle:"bold"});C.setOrigin(.5,.5),n.add(C);const p=this.add.text(0,s*.25,c.description,{fontFamily:"monospace",fontSize:`${Math.floor(s*.05)}px`,color:"#aaaaaa",wordWrap:{width:t*.85},align:"center"});p.setOrigin(.5,.5),n.add(p);const f=this.add.text(0,s*.4,`[ ${c.key} ]`,{fontFamily:"monospace",fontSize:`${Math.floor(s*.06)}px`,color:"#ffff00",fontStyle:"bold"});f.setOrigin(.5,.5),n.add(f),d.setInteractive({useHandCursor:!0});const x=l;d.on("pointerover",()=>{this.setSelectedSkill(x)}),d.on("pointerdown",()=>{this.setSelectedSkill(x),this.selectSkill(x,c.name)}),this.skillPanelContainer.add(n),this.skillOptions.push(n),this.skillCardBgs.push(d)}this.selectedSkillIndex=0}showSkillPanel(){this.isPaused=!0,this.isMoving=!1,this.skillPanelContainer.setVisible(!0),this.selectedSkillIndex=0,this.skillCardBgs.forEach((t,s)=>{s===0?(t.setFillStyle(3355443),t.setStrokeStyle(3,16777215)):(t.setFillStyle(2236962),t.setStrokeStyle(2,6710886))}),this.skillPanelContainer.setAlpha(0),this.tweens.add({targets:this.skillPanelContainer,alpha:1,duration:200}),this.skillOptions.forEach((t,s)=>{t.setScale(s===0?1.05:1),t.setY(this.gameBounds.y+this.gameBounds.height*.55+50),t.setAlpha(0),this.tweens.add({targets:t,y:this.gameBounds.y+this.gameBounds.height*.55,alpha:1,duration:300,delay:s*100,ease:"Back.easeOut"})})}hideSkillPanel(){this.tweens.add({targets:this.skillPanelContainer,alpha:0,duration:200,onComplete:()=>{this.skillPanelContainer.setVisible(!1),this.isPaused=!1}})}selectSkill(t,s){console.log(`Selected skill ${t}: ${s}`);const e=this.skillOptions[t];this.tweens.add({targets:e,scaleX:1.1,scaleY:1.1,duration:100,yoyo:!0,onComplete:()=>{this.hideSkillPanel()}})}};o(B,"MAP_SCALE",10),o(B,"BASE_ICON_SIZE",100),o(B,"BASE_ICON_GAP",10),o(B,"BASE_GROUP_GAP",30),o(B,"BASE_BOTTOM_MARGIN",20),o(B,"ACTIVE_SKILLS",4),o(B,"PASSIVE_SKILLS",3),o(B,"BASE_WIDTH",1920),o(B,"CAMERA_DEAD_ZONE",.3);let O=B;const K=7,D={0:{width:5,pixels:[" ### ","#   #","#  ##","# # #","##  #","#   #"," ### "]},1:{width:3,pixels:[" # ","## "," # "," # "," # "," # ","###"]},2:{width:5,pixels:[" ### ","#   #","    #","  ## "," #   ","#    ","#####"]},3:{width:5,pixels:[" ### ","#   #","    #","  ## ","    #","#   #"," ### "]},4:{width:5,pixels:["#   #","#   #","#   #","#####","    #","    #","    #"]},5:{width:5,pixels:["#####","#    ","#    ","#### ","    #","#   #"," ### "]},6:{width:5,pixels:[" ### ","#    ","#    ","#### ","#   #","#   #"," ### "]},7:{width:5,pixels:["#####","    #","   # ","  #  ","  #  ","  #  ","  #  "]},8:{width:5,pixels:[" ### ","#   #","#   #"," ### ","#   #","#   #"," ### "]},9:{width:5,pixels:[" ### ","#   #","#   #"," ####","    #","    #"," ### "]},A:{width:5,pixels:[" ### ","#   #","#   #","#####","#   #","#   #","#   #"]},D:{width:5,pixels:["#### ","#   #","#   #","#   #","#   #","#   #","#### "]},E:{width:4,pixels:["####","#   ","#   ","### ","#   ","#   ","####"]},G:{width:5,pixels:[" ### ","#    ","#    ","# ###","#   #","#   #"," ### "]},I:{width:3,pixels:["###"," # "," # "," # "," # "," # ","###"]},L:{width:4,pixels:["#   ","#   ","#   ","#   ","#   ","#   ","####"]},N:{width:5,pixels:["#   #","##  #","# # #","#  ##","#   #","#   #","#   #"]},O:{width:5,pixels:[" ### ","#   #","#   #","#   #","#   #","#   #"," ### "]},P:{width:4,pixels:["### ","#  #","#  #","### ","#   ","#   ","#   "]},R:{width:4,pixels:["### ","#  #","#  #","### ","# # ","#  #","#  #"]},S:{width:4,pixels:[" ###","#   ","#   "," ## ","   #","   #","### "]},T:{width:5,pixels:["#####","  #  ","  #  ","  #  ","  #  ","  #  ","  #  "]},"%":{width:5,pixels:["##  #","## # ","  #  "," #   "," # ##","#  ##","   ##"]}," ":{width:3,pixels:["   ","   ","   ","   ","   ","   ","   "]}},z={charHeight:K,chars:D};class ${constructor(){o(this,"font");this.font=z}textToPixels(S,t,s){const e=[],i=S.letterSpacing??1,a=S.color.replace("#",""),h=parseInt(a.substring(0,2),16),r=parseInt(a.substring(2,4),16),l=parseInt(a.substring(4,6),16),c=h<<16|r<<8|l;let u=0;const n=S.text.toUpperCase().split("");for(let p=0;p<n.length;p++){const f=this.font.chars[n[p]];f&&(u+=f.width,p<n.length-1&&(u+=i))}const d=Math.floor(t*S.position.x),m=Math.floor(s*S.position.y),w=d-Math.floor(u/2),g=m-Math.floor(this.font.charHeight/2);let C=w;for(const p of n){const f=this.font.chars[p];if(f){for(let x=0;x<f.pixels.length;x++){const v=f.pixels[x];for(let I=0;I<v.length;I++)if(v[I]==="#"){const k=C+I,E=g+x;k>=0&&k<t&&E>=0&&E<s&&e.push({gridX:k,gridY:E,color:c})}}C+=f.width+i}}return e}processConfig(S,t,s){const e=new Map;for(const i of S.texts){const a=this.textToPixels(i,t,s);e.set(i.id,a)}return e}}const N=[{id:"title",text:"PRESS TO START",letterSpacing:2,position:{x:.5,y:.5},color:"#ffffff"}],_={texts:N},b=class b extends y.Scene{constructor(){super("GridScene");o(this,"cells",[]);o(this,"cols",0);o(this,"rows",0);o(this,"cellWidth",10);o(this,"cellHeight",10);o(this,"gap",1);o(this,"isAnimating",!1);o(this,"isReady",!1);o(this,"textRenderer");o(this,"textPixels",new Map);o(this,"cursorGlowRadius",4);o(this,"glowPhase",0);o(this,"textBreathPhase",0);o(this,"isLoading",!0);o(this,"loadingCells",new Set);o(this,"backgroundImage");this.textRenderer=new $}preload(){this.load.image("background","background.png"),this.load.on("progress",t=>{this.updateLoadingProgress(Math.floor(t*100))})}create(){this.cameras.main.setBackgroundColor("rgba(0,0,0,0)"),this.createBackground(),this.calculateGridSize(),this.createGrid(),this.showLoadingText(0),this.startEntryAnimation(),this.preloadGameAssets(),this.input.on("pointerdown",t=>{if(!this.isReady||this.isAnimating)return;const s=Math.floor(t.x/(this.cellWidth+this.gap)),e=Math.floor(t.y/(this.cellHeight+this.gap));this.startExitAnimation(s,e)}),this.input.on("pointermove",t=>{!this.isReady||this.isAnimating||this.updateCursorGlow(t.x,t.y)})}update(t,s){if(!this.isReady||this.isAnimating)return;this.glowPhase+=s*.002,this.textBreathPhase+=s*.004;const e=this.input.activePointer;e&&this.updateCursorGlow(e.x,e.y),this.updateTextBreath()}updateTextBreath(){const t=.5+.5*Math.sin(this.textBreathPhase),s=Math.floor(204+51*t),e=s<<16|s<<8|s,i=.5+.5*Math.sin(this.textBreathPhase*3),a=t>.6?i*.8:0,h=new Set;this.cells.forEach(r=>{r.isText&&h.add(`${r.x},${r.y}`)}),this.cells.forEach(r=>{if(r.isText)r.graphics.setFillStyle(e),r.graphics.setAlpha(.95);else{const l=`${r.x-1},${r.y-1}`;h.has(l)&&a>0&&(r.graphics.setFillStyle(8939263),r.graphics.setAlpha(a))}})}updateCursorGlow(t,s){const e=Math.floor(t/(this.cellWidth+this.gap)),i=Math.floor(s/(this.cellHeight+this.gap)),a=.3+.7*(.5+.5*Math.sin(this.glowPhase));this.cells.forEach(h=>{const r=h.x-e,l=h.y-i,c=Math.sqrt(r*r+l*l);if(c<=this.cursorGlowRadius){const n=(1-c/this.cursorGlowRadius)*a,d=h.originalColor>>16&255,m=h.originalColor>>8&255,w=h.originalColor&255,g=Math.min(255,Math.floor(d+(255-d)*n)),C=Math.min(255,Math.floor(m+(255-m)*n)),p=Math.min(255,Math.floor(w+(255-w)*n)),f=g<<16|C<<8|p;h.graphics.setFillStyle(f)}else h.graphics.setFillStyle(h.originalColor)})}createBackground(){const t=this.cameras.main.width,s=this.cameras.main.height;this.backgroundImage=this.add.image(t/2,s/2,"background");const e=t/this.backgroundImage.width,i=s/this.backgroundImage.height,a=Math.max(e,i);this.backgroundImage.setScale(a),this.backgroundImage.setDepth(-1)}showLoadingText(t){this.loadingCells.forEach(i=>{this.cells[i]&&(this.cells[i].originalColor=2236962,this.cells[i].isText=!1,this.cells[i].graphics.setFillStyle(2236962),this.cells[i].graphics.setAlpha(.2))}),this.loadingCells.clear();const s=`LOADING ${t}%`;this.textRenderer.textToPixels({id:"loading",text:s,letterSpacing:2,position:{x:.5,y:.5},color:"#ffffff"},this.cols,this.rows).forEach(i=>{const a=i.gridY*this.cols+i.gridX;this.cells[a]&&(this.cells[a].originalColor=i.color,this.cells[a].isText=!0,this.cells[a].graphics.setFillStyle(i.color),this.cells[a].graphics.setAlpha(.95),this.loadingCells.add(a))})}updateLoadingProgress(t){this.isLoading&&this.showLoadingText(t)}preloadGameAssets(){let t=0;const s=this.time.addEvent({delay:50,callback:()=>{t+=Math.random()*15,t>=100&&(t=100,s.destroy(),this.onLoadingComplete()),this.showLoadingText(Math.floor(t))},loop:!0})}onLoadingComplete(){this.isLoading=!1,this.time.delayedCall(500,()=>{this.cells.forEach(t=>{t.originalColor=2236962,t.isText=!1,t.graphics.setFillStyle(2236962),t.graphics.setAlpha(.2)}),this.loadingCells.clear(),this.time.delayedCall(300,()=>{this.processTextConfig(),this.textPixels.forEach(t=>{t.forEach(s=>{const e=s.gridY*this.cols+s.gridX;this.cells[e]&&(this.cells[e].graphics.setFillStyle(s.color),this.cells[e].graphics.setAlpha(.95))})}),this.isAnimating||(this.isReady=!0)})})}calculateGridSize(){const t=this.cameras.main.width,s=this.cameras.main.height,e=Math.min(1,t/b.BASE_WIDTH),i=Math.max(b.MIN_CELL_SIZE,Math.floor(b.BASE_CELL_SIZE*e));this.gap=1,this.cellWidth=i,this.cellHeight=i,this.cols=Math.ceil((t+this.gap)/(i+this.gap)),this.rows=Math.ceil((s+this.gap)/(i+this.gap));const a=.05,h=t*(1-a*2),r=s*(1-a*2),l=16/9,c=h/r;let u,n;c>l?(n=r,u=r*l):(u=h,n=h/l);const d=(t-u)/2,m=(s-n)/2;this.registry.set("gameBounds",{x:d,y:m,width:u,height:n}),console.log(`Grid: ${this.cols}x${this.rows}, cellSize: ${i}, gameBounds: ${u.toFixed(0)}x${n.toFixed(0)}`)}createGrid(){for(let t=0;t<this.rows;t++)for(let s=0;s<this.cols;s++){const e=s*(this.cellWidth+this.gap)+this.cellWidth/2,i=t*(this.cellHeight+this.gap)+this.cellHeight/2,a=this.add.rectangle(e,i,this.cellWidth,this.cellHeight,2236962);a.setAlpha(0),this.cells.push({x:s,y:t,graphics:a,delay:0,originalColor:2236962,isText:!1})}}processTextConfig(){this.textPixels=this.textRenderer.processConfig(_,this.cols,this.rows),this.textPixels.forEach(t=>{t.forEach(s=>{const e=s.gridY*this.cols+s.gridX;this.cells[e]&&(this.cells[e].originalColor=s.color,this.cells[e].isText=!0)})})}startEntryAnimation(){this.isAnimating=!0;const t=new Set;for(let g=0;g<this.cells.length;g++)t.add(g);const s=20,e=50,i=10,h=Math.floor(200/i),r=3e3;let l=0,c=!1;const u=(g,C)=>C*this.cols+g,n=g=>({x:g%this.cols,y:Math.floor(g/this.cols)}),d=g=>{const C=this.cells[g];C.graphics.setAlpha(1),C.graphics.setFillStyle(16777215),this.tweens.add({targets:C.graphics,fillColor:{from:16777215,to:C.originalColor},alpha:{from:1,to:.2},duration:80,ease:"Linear"})},m=g=>{const{x:C,y:p}=n(g),f=h,x=[];for(let k=0;k<=f;k++)x[k]=[];for(let k=-f;k<=f;k++)for(let E=-f;E<=f;E++){const A=C+E,P=p+k;if(A>=0&&A<this.cols&&P>=0&&P<this.rows){const Y=Math.sqrt(E*E+k*k),F=Math.floor(Y);if(F<=f){const X=u(A,P);x[F].push(X)}}}let v=0;const I=()=>{v>f||(x[v].forEach(k=>{t.has(k)&&(t.delete(k),d(k))}),v++,v<=f&&this.time.delayedCall(i,I))};I()},w=()=>{if(c)return;if(l>=r||t.size===0){this.finishEntry(t),c=!0;return}const g=Array.from(t),C=Math.min(s,g.length);for(let p=0;p<C&&g.length!==0;p++){const f=Math.floor(Math.random()*g.length),x=g[f];g.splice(f,1),t.has(x)&&m(x)}l+=e,t.size>0&&l<r?this.time.delayedCall(e,w):c||(this.finishEntry(t),c=!0)};w()}finishEntry(t){t.forEach(s=>{const e=this.cells[s];e.graphics.setAlpha(.2),e.graphics.setFillStyle(e.originalColor)}),this.time.delayedCall(100,()=>{this.isAnimating=!1,this.isLoading||(this.isReady=!0)})}startExitAnimation(t,s){this.isAnimating=!0;const e=this.cameras.main.width,i=this.cameras.main.height;this.scene.launch("MainScene"),this.scene.bringToTop("GridScene");const a=t*(this.cellWidth+this.gap)+this.cellWidth/2,h=s*(this.cellHeight+this.gap)+this.cellHeight/2;this.registry.events.emit("reveal-update",{x:a,y:h,radius:0}),this.cells.forEach(n=>{n.graphics.setFillStyle(1118481),n.graphics.setAlpha(1)}),this.backgroundImage.setVisible(!1);const r=5;let l=0;this.cells.forEach(n=>{const d=n.x-t,m=n.y-s,w=Math.sqrt(d*d+m*m);n.delay=Math.floor(w*r),n.delay>l&&(l=n.delay)});const c=Math.sqrt(Math.max(a,e-a)**2+Math.max(h,i-h)**2)+50,u=l+150;this.tweens.addCounter({from:0,to:c,duration:u,ease:"Linear",onUpdate:n=>{const d=n.getValue()??0;this.registry.events.emit("reveal-update",{x:a,y:h,radius:d})}}),this.cells.forEach(n=>{this.time.delayedCall(n.delay,()=>{this.tweens.addCounter({from:0,to:100,duration:150,ease:"Power1",onUpdate:d=>{const m=d.getValue()??0;let w;m<20?w=16777215:m<40?w=16776960:m<60?w=16746496:m<80?w=16720384:w=4456448,n.graphics.setFillStyle(w),n.graphics.setAlpha(1-m/100)},onComplete:()=>{n.graphics.setVisible(!1)}})})}),this.time.delayedCall(l+200,()=>{this.registry.events.emit("reveal-complete"),this.scene.stop("GridScene")})}};o(b,"BASE_CELL_SIZE",10),o(b,"MIN_CELL_SIZE",4),o(b,"BASE_WIDTH",1920);let L=b,T=null;function V(){return window.innerWidth>window.innerHeight}function Z(){if(T)return;const M={type:y.AUTO,width:window.innerWidth,height:window.innerHeight,parent:"app",backgroundColor:"#111111",scale:{mode:y.Scale.RESIZE,autoCenter:y.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scene:[L,H,O]};T=new y.Game(M)}function G(){(window.innerWidth>900||V())&&Z()}G();window.addEventListener("resize",G);window.addEventListener("orientationchange",()=>{setTimeout(G,100)});
