var K=Object.defineProperty;var z=(L,r,t)=>r in L?K(L,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):L[r]=t;var o=(L,r,t)=>z(L,typeof r!="symbol"?r+"":r,t);import{P as C}from"./phaser-0RJB29YE.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();class $ extends C.Scene{constructor(){super("BootScene")}preload(){}create(){const r=this.cameras.main.width,t=this.cameras.main.height;this.add.text(r/2,t/2,"Loading...",{font:"20px monospace",color:"#ffffff"}).setOrigin(.5,.5),this.scene.start("MainScene")}}const O=[{id:"attack_1",name:"SKILL A",description:"Attack skill A",type:"active",color:16737894,maxLevel:5},{id:"attack_2",name:"SKILL B",description:"Attack skill B",type:"active",color:6750054,maxLevel:5},{id:"attack_3",name:"SKILL C",description:"Attack skill C",type:"active",color:6711039,maxLevel:5},{id:"attack_4",name:"SKILL D",description:"Attack skill D",type:"active",color:16777062,maxLevel:5},{id:"passive_titanium_liver",name:"鈦金肝",description:"每級提升 5% HP 總量",type:"passive",color:13404262,maxLevel:5},{id:"passive_sync_rate",name:"精神同步率強化",description:"每級提升 8% 移動速度、減少 5% 技能冷卻",type:"passive",color:6737151,maxLevel:5},{id:"passive_retina_module",name:"視網膜增強模組",description:"每級提升 10% 經驗取得量",type:"passive",color:10092390,maxLevel:5}];class W{constructor(){o(this,"playerSkills",new Map)}getActiveSkillDefinitions(){return O.filter(r=>r.type==="active")}getPassiveSkillDefinitions(){return O.filter(r=>r.type==="passive")}getPlayerSkill(r){return this.playerSkills.get(r)}getPlayerActiveSkills(){return this.getActiveSkillDefinitions().map(t=>this.playerSkills.get(t.id)||null)}getPlayerPassiveSkills(){return this.getPassiveSkillDefinitions().map(t=>this.playerSkills.get(t.id)||null)}getSkillLevel(r){const t=this.playerSkills.get(r);return t?t.level:-1}isSkillMaxLevel(r){const t=this.playerSkills.get(r);return t?t.level>=t.definition.maxLevel:!1}learnOrUpgradeSkill(r){const t=O.find(s=>s.id===r);if(!t)return!1;const e=this.playerSkills.get(r);if(e){if(e.level>=t.maxLevel)return!1;e.level++}else this.playerSkills.set(r,{definition:t,level:0});return!0}getUpgradeableActiveSkills(){return this.getActiveSkillDefinitions().filter(r=>{const t=this.playerSkills.get(r.id);return!t||t.level<r.maxLevel})}getUpgradeablePassiveSkills(){return this.getPassiveSkillDefinitions().filter(r=>{const t=this.playerSkills.get(r.id);return!t||t.level<r.maxLevel})}hasAnyActiveSkill(){return this.getActiveSkillDefinitions().some(t=>this.playerSkills.has(t.id))}getRandomSkillOptions(){const r=this.getUpgradeableActiveSkills(),t=this.getUpgradeablePassiveSkills(),e=[];if(!this.hasAnyActiveSkill()){const a=this.shuffleArray([...r]);for(let l=0;l<Math.min(3,a.length);l++)e.push(a[l]);return e}const s=this.shuffleArray([...r]);for(let a=0;a<Math.min(2,s.length);a++)e.push(s[a]);const i=this.shuffleArray([...t]);return i.length>0&&e.push(i[0]),e}hasUpgradeableSkills(){return this.getUpgradeableActiveSkills().length>0||this.getUpgradeablePassiveSkills().length>0}shuffleArray(r){for(let t=r.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[r[t],r[e]]=[r[e],r[t]]}return r}static formatLevel(r,t=5){return r<=0?"Lv.0":r>=t?"MAX":`Lv.${r}`}getTitaniumLiverHpBonus(){const r=this.playerSkills.get("passive_titanium_liver");return r?(r.level+1)*.05:0}getSyncRateSpeedBonus(){const r=this.playerSkills.get("passive_sync_rate");return r?(r.level+1)*.08:0}getSyncRateCooldownReduction(){const r=this.playerSkills.get("passive_sync_rate");return r?(r.level+1)*.05:0}getRetinaModuleExpBonus(){const r=this.playerSkills.get("passive_retina_module");return r?(r.level+1)*.1:0}calculateFinalMaxHp(r){const t=this.getTitaniumLiverHpBonus();return Math.floor(r*(1+t))}calculateFinalMoveSpeed(r){const t=this.getSyncRateSpeedBonus();return r*(1+t)}calculateFinalCooldown(r){const t=this.getSyncRateCooldownReduction();return r*(1-t)}calculateFinalExp(r){const t=this.getRetinaModuleExpBonus();return Math.floor(r*(1+t))}}const g=class g extends C.Scene{constructor(){super("MainScene");o(this,"character");o(this,"characterState","idle");o(this,"facingRight",!0);o(this,"skillIcons",[]);o(this,"gameBounds");o(this,"boundsBorder");o(this,"background");o(this,"gameAreaContainer");o(this,"revealMask");o(this,"mapWidth");o(this,"mapHeight");o(this,"characterX");o(this,"characterY");o(this,"characterSize");o(this,"isMoving",!1);o(this,"isPointerDown",!1);o(this,"targetX");o(this,"targetY");o(this,"baseMoveSpeed",200);o(this,"moveSpeed",200);o(this,"floorGrid");o(this,"worldContainer");o(this,"uiContainer");o(this,"cameraOffsetX",0);o(this,"cameraOffsetY",0);o(this,"cursors");o(this,"isKeyboardMoving",!1);o(this,"skillPanelContainer");o(this,"isPaused",!1);o(this,"skillOptions",[]);o(this,"skillCardBgs",[]);o(this,"selectedSkillIndex",0);o(this,"currentSkillChoices",[]);o(this,"skillManager",new W);o(this,"skillIconContainers",[]);o(this,"skillLevelTexts",[]);o(this,"currentExp",0);o(this,"maxExp",100);o(this,"currentLevel",0);o(this,"expBarContainer");o(this,"expBarFill");o(this,"expBarFlowOffset",0);o(this,"levelText");o(this,"currentHp",20);o(this,"maxHp",20);o(this,"hpBarContainer");o(this,"hpBarFill");o(this,"hpBarFlowOffset",0);o(this,"hpText");o(this,"keyPlus");o(this,"keyMinus");o(this,"keyShift")}create(){this.cameras.main.setBackgroundColor("#111111");const t=this.cameras.main.width,e=this.cameras.main.height;if(this.gameBounds=this.registry.get("gameBounds"),!this.gameBounds){const h=t*.9,d=e*(1-.05*2),c=16/9,p=h/d;let n,m;p>c?(m=d,n=d*c):(n=h,m=h/c),this.gameBounds={x:(t-n)/2,y:(e-m)/2,width:n,height:m}}this.mapWidth=this.gameBounds.width*g.MAP_SCALE,this.mapHeight=this.gameBounds.height*g.MAP_SCALE,this.characterSize=this.gameBounds.height*.15,this.characterX=this.mapWidth/2,this.characterY=this.mapHeight/2,this.createFullscreenBackground(t,e),this.gameAreaContainer=this.add.container(0,0),this.drawGameBorder(),this.worldContainer=this.add.container(this.gameBounds.x,this.gameBounds.y),this.floorGrid=this.add.graphics(),this.drawFloorGrid(),this.worldContainer.add(this.floorGrid),this.createCharacterAnimations(),this.character=this.add.sprite(this.characterX,this.characterY,"char_idle"),this.character.setScale(this.characterSize/this.character.height),this.character.setOrigin(.5,1),this.character.play("char_idle"),this.worldContainer.add(this.character),this.gameAreaContainer.add([this.boundsBorder,this.worldContainer]);const s=this.make.graphics({x:0,y:0});s.fillStyle(16777215),s.fillRect(this.gameBounds.x,this.gameBounds.y,this.gameBounds.width,this.gameBounds.height);const i=s.createGeometryMask();this.worldContainer.setMask(i),this.uiContainer=this.add.container(0,0),this.createSkillBar(),this.revealMask=this.make.graphics({x:0,y:0});const a=this.revealMask.createGeometryMask();this.gameAreaContainer.setMask(a),this.uiContainer.setMask(a),this.registry.events.on("reveal-update",this.updateRevealMask,this),this.registry.events.on("reveal-complete",this.onRevealComplete,this),this.input.on("pointerdown",this.onPointerDown,this),this.input.on("pointermove",this.onPointerMove,this),this.input.on("pointerup",this.onPointerUp,this),this.input.keyboard&&(this.cursors={W:this.input.keyboard.addKey(C.Input.Keyboard.KeyCodes.W),A:this.input.keyboard.addKey(C.Input.Keyboard.KeyCodes.A),S:this.input.keyboard.addKey(C.Input.Keyboard.KeyCodes.S),D:this.input.keyboard.addKey(C.Input.Keyboard.KeyCodes.D)},this.keyPlus=this.input.keyboard.addKey(C.Input.Keyboard.KeyCodes.PLUS),this.keyMinus=this.input.keyboard.addKey(C.Input.Keyboard.KeyCodes.MINUS),this.keyShift=this.input.keyboard.addKey(C.Input.Keyboard.KeyCodes.SHIFT)),this.updateCamera(!0),this.createHpBar(),this.createExpBar(),this.createSkillPanel()}update(t,e){if(this.updateHpBarFlow(e),this.updateExpBarFlow(e),this.isPaused){this.handleSkillPanelInput();return}this.handleExpTestInput(),this.handleKeyboardInput(e),this.isMoving&&!this.isKeyboardMoving&&this.moveCharacter(e)}handleExpTestInput(){if(!(!this.keyPlus||!this.keyMinus||!this.keyShift)){if(this.keyShift.isDown&&C.Input.Keyboard.JustDown(this.keyPlus)){this.levelUp();return}this.keyPlus.isDown&&!this.keyShift.isDown&&this.addExp(10),this.keyMinus.isDown&&this.addExp(-10)}}addExp(t){t>0&&(t=this.skillManager.calculateFinalExp(t)),this.currentExp+=t,this.currentExp<0&&(this.currentExp=0),this.currentExp>=this.maxExp&&this.levelUp(),this.drawExpBarFill()}levelUp(){this.currentLevel++,this.currentExp=0,this.maxExp=Math.floor(g.BASE_EXP*Math.pow(g.EXP_GROWTH_RATE,this.currentLevel)),this.recalculateMaxHp(),this.currentHp=this.maxHp,this.levelText.setText(`Lv.${this.currentLevel}`),this.drawHpBarFill(),this.updateHpText(),this.showSkillPanel(),this.drawExpBarFill(),console.log(`Level up! Lv.${this.currentLevel}, MaxHP: ${this.maxHp}, NextExp: ${this.maxExp}`)}recalculateMaxHp(){const t=g.BASE_HP+g.HP_PER_LEVEL*this.currentLevel,e=this.maxHp;if(this.maxHp=this.skillManager.calculateFinalMaxHp(t),this.maxHp>e&&e>0){const s=this.currentHp/e;this.currentHp=Math.floor(this.maxHp*s)}this.currentHp=Math.min(this.currentHp,this.maxHp)}recalculateMoveSpeed(){this.moveSpeed=this.skillManager.calculateFinalMoveSpeed(this.baseMoveSpeed)}handleSkillPanelInput(){this.cursors&&(C.Input.Keyboard.JustDown(this.cursors.A)&&this.setSelectedSkill(0),C.Input.Keyboard.JustDown(this.cursors.S)&&this.setSelectedSkill(1),C.Input.Keyboard.JustDown(this.cursors.D)&&this.setSelectedSkill(2),C.Input.Keyboard.JustDown(this.cursors.W)&&this.confirmSkillSelection())}setSelectedSkill(t){this.updateSkillCardStyle(this.selectedSkillIndex,!1),this.selectedSkillIndex=t,this.updateSkillCardStyle(this.selectedSkillIndex,!0)}updateSkillCardStyle(t,e){const s=this.skillCardBgs[t],i=this.skillOptions[t];!s||!i||(e?(s.setFillStyle(3355443),s.setStrokeStyle(3,16777215),this.tweens.add({targets:i,scaleX:1.05,scaleY:1.05,duration:100})):(s.setFillStyle(2236962),s.setStrokeStyle(2,6710886),this.tweens.add({targets:i,scaleX:1,scaleY:1,duration:100})))}confirmSkillSelection(){if(this.currentSkillChoices.length===0||this.selectedSkillIndex>=this.currentSkillChoices.length)return;const t=this.currentSkillChoices[this.selectedSkillIndex];this.selectSkill(this.selectedSkillIndex,t.id)}handleKeyboardInput(t){if(!this.cursors)return;let e=0,s=0;if(this.cursors.W.isDown&&(s=-1),this.cursors.S.isDown&&(s=1),this.cursors.A.isDown&&(e=-1),this.cursors.D.isDown&&(e=1),e!==0||s!==0){if(this.isKeyboardMoving=!0,this.isMoving=!1,e!==0&&(this.facingRight=e>0),e!==0&&s!==0){const a=1/Math.sqrt(2);e*=a,s*=a}const i=this.moveSpeed*t/1e3;this.characterX+=e*i,this.characterY+=s*i,this.characterX=C.Math.Clamp(this.characterX,this.characterSize,this.mapWidth-this.characterSize),this.characterY=C.Math.Clamp(this.characterY,this.characterSize,this.mapHeight-this.characterSize),this.setCharacterState("run"),this.updateCharacterSprite(),this.updateCamera()}else this.isKeyboardMoving=!1,this.isMoving||(this.setCharacterState("idle"),this.updateCharacterSprite())}onPointerDown(t){this.isPaused||this.isPointerInGameArea(t)&&(this.isPointerDown=!0,this.updateTargetFromPointer(t),this.isMoving=!0)}onPointerMove(t){!this.isPointerDown||this.isPaused||this.isPointerInGameArea(t)&&this.updateTargetFromPointer(t)}onPointerUp(){this.isPointerDown=!1}isPointerInGameArea(t){return t.x>=this.gameBounds.x&&t.x<=this.gameBounds.x+this.gameBounds.width&&t.y>=this.gameBounds.y&&t.y<=this.gameBounds.y+this.gameBounds.height}updateTargetFromPointer(t){const e=t.x-this.gameBounds.x,s=t.y-this.gameBounds.y,i=e+this.cameraOffsetX,a=s+this.cameraOffsetY;this.targetX=C.Math.Clamp(i,this.characterSize,this.mapWidth-this.characterSize),this.targetY=C.Math.Clamp(a,this.characterSize,this.mapHeight-this.characterSize)}moveCharacter(t){const e=this.targetX-this.characterX,s=this.targetY-this.characterY,i=Math.sqrt(e*e+s*s);if(this.updateCharacterFacing(this.targetX),i<5)this.characterX=this.targetX,this.characterY=this.targetY,this.isMoving=!1,this.setCharacterState("idle");else{const a=this.moveSpeed*t/1e3;if(a>=i)this.characterX=this.targetX,this.characterY=this.targetY,this.isMoving=!1,this.setCharacterState("idle");else{const l=a/i;this.characterX+=e*l,this.characterY+=s*l,this.setCharacterState("run")}}this.updateCharacterSprite(),this.updateCamera()}updateCamera(t=!1){const e=this.cameraOffsetX+this.gameBounds.width/2,s=this.cameraOffsetY+this.gameBounds.height/2,i=this.characterX-e,a=this.characterY-s,l=this.gameBounds.width*g.CAMERA_DEAD_ZONE,h=this.gameBounds.height*g.CAMERA_DEAD_ZONE;t?(this.cameraOffsetX=this.characterX-this.gameBounds.width/2,this.cameraOffsetY=this.characterY-this.gameBounds.height/2):(Math.abs(i)>l/2&&(i>0?this.cameraOffsetX+=i-l/2:this.cameraOffsetX+=i+l/2),Math.abs(a)>h/2&&(a>0?this.cameraOffsetY+=a-h/2:this.cameraOffsetY+=a+h/2)),this.cameraOffsetX=C.Math.Clamp(this.cameraOffsetX,0,this.mapWidth-this.gameBounds.width),this.cameraOffsetY=C.Math.Clamp(this.cameraOffsetY,0,this.mapHeight-this.gameBounds.height),this.worldContainer.setPosition(this.gameBounds.x-this.cameraOffsetX,this.gameBounds.y-this.cameraOffsetY)}updateRevealMask(t){this.revealMask&&(this.revealMask.clear(),this.revealMask.fillStyle(16777215),this.revealMask.fillCircle(t.x,t.y,t.radius))}onRevealComplete(){this.gameAreaContainer.clearMask(!0),this.uiContainer.clearMask(!0),this.revealMask.destroy(),this.registry.events.off("reveal-update",this.updateRevealMask,this),this.registry.events.off("reveal-complete",this.onRevealComplete,this);const t=document.getElementById("controls");t&&t.classList.add("visible"),this.showSkillPanel()}createFullscreenBackground(t,e){this.background=this.add.image(t/2,e/2,"background");const s=t/this.background.width,i=e/this.background.height,a=Math.max(s,i);this.background.setScale(a)}drawGameBorder(){this.boundsBorder=this.add.rectangle(this.gameBounds.x+this.gameBounds.width/2,this.gameBounds.y+this.gameBounds.height/2,this.gameBounds.width,this.gameBounds.height,0),this.boundsBorder.setStrokeStyle(2,4473924)}createHpBar(){this.hpBarContainer=this.add.container(0,0),this.hpBarContainer.setDepth(100);const e=this.gameBounds.height*.01*2,s=Math.min(1,this.gameBounds.width/g.BASE_WIDTH),i=Math.max(.4,s),a=Math.floor(g.BASE_ICON_SIZE*i),l=Math.floor(g.BASE_ICON_GAP*i),h=Math.floor(g.BASE_GROUP_GAP*i),d=Math.floor(g.BASE_BOTTOM_MARGIN*i),c=g.ACTIVE_SKILLS,p=g.PASSIVE_SKILLS,n=c*a+(c-1)*l,m=p*a+(p-1)*l,S=n+h+m,x=this.gameBounds.x+(this.gameBounds.width-S)/2,k=this.gameBounds.y+this.gameBounds.height-a-d-e-8,y=this.add.rectangle(x+S/2,k+e/2,S,e,0);y.setStrokeStyle(1,3355443),this.hpBarContainer.add(y),this.hpBarFill=this.add.graphics(),this.hpBarContainer.add(this.hpBarFill);const u=Math.floor(this.gameBounds.height*.03);this.hpText=this.add.text(x+S/2,k+e/2,`${this.currentHp} / ${this.maxHp}`,{fontFamily:"monospace",fontSize:`${u}px`,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:3}),this.hpText.setOrigin(.5,.5),this.hpBarContainer.add(this.hpText),this.drawHpBarFill(),this.uiContainer.add(this.hpBarContainer)}drawHpBarFill(){this.hpBarFill.clear();const e=this.gameBounds.height*.01*2,s=Math.min(1,this.gameBounds.width/g.BASE_WIDTH),i=Math.max(.4,s),a=Math.floor(g.BASE_ICON_SIZE*i),l=Math.floor(g.BASE_ICON_GAP*i),h=Math.floor(g.BASE_GROUP_GAP*i),d=Math.floor(g.BASE_BOTTOM_MARGIN*i),c=g.ACTIVE_SKILLS,p=g.PASSIVE_SKILLS,n=c*a+(c-1)*l,m=p*a+(p-1)*l,S=n+h+m,x=this.gameBounds.x+(this.gameBounds.width-S)/2,k=this.gameBounds.y+this.gameBounds.height-a-d-e-8,y=this.currentHp/this.maxHp,u=S*y;if(u<=0)return;const M=Math.ceil(u/2)+1;for(let E=0;E<M;E++){const w=x+E*2;if(w>=x+u)break;const v=(w-x)/S,B=this.hpBarFlowOffset,A=(v+B)%1,P=(Math.sin(A*Math.PI*2-Math.PI/2)+1)/2,b=Math.floor(136-34*P),T=Math.floor(0+0*P),F=Math.floor(34+102*P),X=b<<16|T<<8|F;this.hpBarFill.fillStyle(X,1);const Y=Math.min(2,x+u-w);this.hpBarFill.fillRect(w,k,Y,e)}this.hpBarFill.fillStyle(16777215,.15),this.hpBarFill.fillRect(x,k,u,e*.4)}updateHpBarFlow(t){this.hpBarFlowOffset+=.08*t/1e3,this.hpBarFlowOffset>=1&&(this.hpBarFlowOffset-=1),this.drawHpBarFill()}updateHpText(){this.hpText&&this.hpText.setText(`${this.currentHp} / ${this.maxHp}`)}createExpBar(){this.expBarContainer=this.add.container(0,0),this.expBarContainer.setDepth(100);const t=this.gameBounds.height*.01,e=this.gameBounds.width,s=this.gameBounds.x,i=this.gameBounds.y+this.gameBounds.height-t,a=this.add.rectangle(s+e/2,i+t/2,e,t,0);this.expBarContainer.add(a),this.expBarFill=this.add.graphics(),this.expBarContainer.add(this.expBarFill),this.drawExpBarFill();const l=Math.floor(this.gameBounds.height*.03);this.levelText=this.add.text(this.gameBounds.x+10,i-l-5,`Lv.${this.currentLevel}`,{fontFamily:"monospace",fontSize:`${l}px`,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:3}),this.levelText.setOrigin(0,1),this.expBarContainer.add(this.levelText)}drawExpBarFill(){this.expBarFill.clear();const t=this.gameBounds.height*.01,e=this.gameBounds.width,s=this.gameBounds.x,i=this.gameBounds.y+this.gameBounds.height-t,a=this.currentExp/this.maxExp,l=e*a;if(l<=0)return;const h=Math.ceil(l/2)+1;for(let d=0;d<h;d++){const c=s+d*2;if(c>=s+l)break;const p=(c-s)/e,n=this.expBarFlowOffset,m=(p+n)%1,S=(Math.sin(m*Math.PI*2-Math.PI/2)+1)/2,x=Math.floor(68+68*S),f=Math.floor(136-68*S),y=x<<16|f<<8|255;this.expBarFill.fillStyle(y,1);const u=Math.min(2,s+l-c);this.expBarFill.fillRect(c,i,u,t)}this.expBarFill.fillStyle(16777215,.2),this.expBarFill.fillRect(s,i,l,t*.4)}updateExpBarFlow(t){this.expBarFlowOffset+=.1*t/1e3,this.expBarFlowOffset>=1&&(this.expBarFlowOffset-=1),this.drawExpBarFill()}drawFloorGrid(){this.floorGrid.clear();const t=this.gameBounds.height/10,e=Math.ceil(this.mapWidth/t),s=Math.ceil(this.mapHeight/t);for(let h=0;h<s;h++)for(let d=0;d<e;d++){const c=d*t,p=h*t;(h+d)%2===0?this.floorGrid.fillStyle(3355443,1):this.floorGrid.fillStyle(4473924,1),this.floorGrid.fillRect(c,p,t,t),this.floorGrid.lineStyle(1,5592405,.5),this.floorGrid.strokeRect(c,p,t,t)}this.floorGrid.lineStyle(4,16729156,1),this.floorGrid.strokeRect(0,0,this.mapWidth,this.mapHeight),this.floorGrid.lineStyle(2,16776960,1);const i=this.mapWidth/2,a=this.mapHeight/2,l=t;this.floorGrid.strokeRect(i-l/2,a-l/2,l,l);for(let h=0;h<s;h+=5)for(let d=0;d<e;d+=5){const c=d*t+t/2,p=h*t+t/2;this.floorGrid.fillStyle(6710886,1),this.floorGrid.fillCircle(c,p,4)}}createSkillBar(){var M,E;const t=this.gameBounds,e=Math.min(1,t.width/g.BASE_WIDTH),s=Math.max(.4,e),i=Math.floor(g.BASE_ICON_SIZE*s),a=Math.floor(g.BASE_ICON_GAP*s),l=Math.floor(g.BASE_GROUP_GAP*s),h=Math.floor(g.BASE_BOTTOM_MARGIN*s),d=Math.max(1,Math.floor(2*s)),c=g.ACTIVE_SKILLS,p=g.PASSIVE_SKILLS,n=c*i+(c-1)*a,m=p*i+(p-1)*a,S=n+l+m,x=t.x+(t.width-S)/2+i/2,f=t.y+t.height-i/2-h,k=this.skillManager.getActiveSkillDefinitions(),y=this.skillManager.getPassiveSkillDefinitions();for(let w=0;w<c;w++){const v=x+w*(i+a),B=this.add.container(v,f),A=this.add.rectangle(0,0,i,i);A.setStrokeStyle(d,16777215),A.setFillStyle(0,0),B.add(A);const P=this.add.rectangle(0,0,i-4,i-4,((M=k[w])==null?void 0:M.color)||3355443,0);B.add(P);const b=this.add.text(0,i*.3,"",{fontFamily:"monospace",fontSize:`${Math.floor(i*.25)}px`,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:2});b.setOrigin(.5,.5),B.add(b),this.skillIcons.push(A),this.skillIconContainers.push(B),this.skillLevelTexts.push(b),this.uiContainer.add(B)}const u=x+n+l;for(let w=0;w<p;w++){const v=u+w*(i+a),B=this.add.container(v,f),A=this.add.rectangle(0,0,i,i);A.setStrokeStyle(d,16777215),A.setFillStyle(0,0),B.add(A);const P=this.add.rectangle(0,0,i-4,i-4,((E=y[w])==null?void 0:E.color)||3355443,0);B.add(P);const b=this.add.text(0,i*.3,"",{fontFamily:"monospace",fontSize:`${Math.floor(i*.25)}px`,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:2});b.setOrigin(.5,.5),B.add(b),this.skillIcons.push(A),this.skillIconContainers.push(B),this.skillLevelTexts.push(b),this.uiContainer.add(B)}}updateSkillBarDisplay(){const t=this.skillManager.getPlayerActiveSkills(),e=this.skillManager.getPlayerPassiveSkills(),s=[...t,...e],i=this.skillManager.getActiveSkillDefinitions(),a=this.skillManager.getPassiveSkillDefinitions(),l=[...i,...a];for(let h=0;h<this.skillIconContainers.length;h++){const d=this.skillIconContainers[h],c=this.skillLevelTexts[h],p=s[h],n=l[h],m=d.list[1];p?(m.setFillStyle(n.color,.5),c.setText(W.formatLevel(p.level,p.definition.maxLevel))):(m.setFillStyle(3355443,0),c.setText(""))}}createCharacterAnimations(){this.anims.create({key:"char_idle",frames:[{key:"char_idle"}],frameRate:1,repeat:-1}),this.anims.create({key:"char_run",frames:[{key:"char_run_1"},{key:"char_run_2"}],frameRate:8,repeat:-1}),this.anims.create({key:"char_attack",frames:[{key:"char_attack_1"},{key:"char_attack_2"}],frameRate:8,repeat:0}),this.anims.create({key:"char_hurt",frames:[{key:"char_hurt"}],frameRate:1,repeat:0})}updateCharacterSprite(){this.character.setPosition(this.characterX,this.characterY),this.character.setScale((this.facingRight?1:-1)*(this.characterSize/this.character.height),this.characterSize/this.character.height)}setCharacterState(t){this.characterState!==t&&(this.characterState=t,this.character.play(`char_${t}`))}updateCharacterFacing(t){t>this.characterX?this.facingRight=!0:t<this.characterX&&(this.facingRight=!1)}createSkillPanel(){this.skillPanelContainer=this.add.container(0,0),this.skillPanelContainer.setVisible(!1),this.uiContainer.add(this.skillPanelContainer);const t=this.add.rectangle(this.gameBounds.x+this.gameBounds.width/2,this.gameBounds.y+this.gameBounds.height/2,this.gameBounds.width,this.gameBounds.height,0,.8);t.setInteractive(),this.skillPanelContainer.add(t);const e=this.gameBounds.y+this.gameBounds.height*.12,s=this.add.text(this.gameBounds.x+this.gameBounds.width/2,e,"選擇技能",{fontFamily:"Microsoft JhengHei, PingFang TC, sans-serif",fontSize:`${Math.floor(this.gameBounds.height*.07)}px`,color:"#ffffff",fontStyle:"bold"});s.setOrigin(.5,.5),this.skillPanelContainer.add(s);const i=e+this.gameBounds.height*.06,a=this.add.text(this.gameBounds.x+this.gameBounds.width/2,i,"提升你的數位能力",{fontFamily:"Microsoft JhengHei, PingFang TC, sans-serif",fontSize:`${Math.floor(this.gameBounds.height*.025)}px`,color:"#aaaaaa"});a.setOrigin(.5,.5),this.skillPanelContainer.add(a),this.createSkillOptions();const l=this.gameBounds.y+this.gameBounds.height*.92,h=this.add.text(this.gameBounds.x+this.gameBounds.width/2,l,"點選或按 W 確定",{fontFamily:"Microsoft JhengHei, PingFang TC, sans-serif",fontSize:`${Math.floor(this.gameBounds.height*.022)}px`,color:"#666666"});h.setOrigin(.5,.5),this.skillPanelContainer.add(h)}createSkillOptions(){if(this.skillOptions.forEach(c=>c.destroy()),this.skillOptions=[],this.skillCardBgs=[],this.currentSkillChoices=this.skillManager.getRandomSkillOptions(),this.currentSkillChoices.length===0)return;const t=this.gameBounds.width*.25,e=this.gameBounds.height*.5,s=this.gameBounds.width*.05,i=this.currentSkillChoices.length,a=t*i+s*(i-1),l=this.gameBounds.x+(this.gameBounds.width-a)/2+t/2,h=this.gameBounds.y+this.gameBounds.height*.55,d=["A","S","D"];for(let c=0;c<this.currentSkillChoices.length;c++){const p=this.currentSkillChoices[c],n=this.skillManager.getSkillLevel(p.id),m=n<0,S=m?"-":n,x=m?0:n+1,f=l+c*(t+s),k=this.add.container(f,h),y=this.add.rectangle(0,0,t,e,2236962);y.setStrokeStyle(2,6710886),k.add(y);const u=this.add.text(0,-e*.42,p.type==="active"?"ACTIVE":"PASSIVE",{fontFamily:"monospace",fontSize:`${Math.floor(e*.045)}px`,color:p.type==="active"?"#ff6666":"#66ffff",fontStyle:"bold"});u.setOrigin(.5,.5),k.add(u);const M=t*.5,E=-e*.18,w=this.add.rectangle(0,E,M,M,p.color,.3);w.setStrokeStyle(2,p.color),k.add(w);const v=this.add.text(0,e*.08,p.name,{fontFamily:"monospace",fontSize:`${Math.floor(e*.08)}px`,color:"#ffffff",fontStyle:"bold"});v.setOrigin(.5,.5),k.add(v);let B;x>=p.maxLevel?B=`Lv.${S} → MAX`:m?B=`NEW → Lv.${x}`:B=`Lv.${S} → Lv.${x}`;const A=this.add.text(0,e*.18,B,{fontFamily:"monospace",fontSize:`${Math.floor(e*.05)}px`,color:x>=p.maxLevel?"#ffff00":"#88ff88",fontStyle:"bold"});A.setOrigin(.5,.5),k.add(A);const P=this.add.text(0,e*.3,p.description,{fontFamily:"monospace",fontSize:`${Math.floor(e*.045)}px`,color:"#aaaaaa",wordWrap:{width:t*.85},align:"center"});P.setOrigin(.5,.5),k.add(P);const b=this.add.text(0,e*.42,`[ ${d[c]} ]`,{fontFamily:"monospace",fontSize:`${Math.floor(e*.06)}px`,color:"#ffff00",fontStyle:"bold"});b.setOrigin(.5,.5),k.add(b),y.setInteractive({useHandCursor:!0});const T=c;y.on("pointerover",()=>{this.setSelectedSkill(T)}),y.on("pointerdown",()=>{this.setSelectedSkill(T),this.confirmSkillSelection()}),this.skillPanelContainer.add(k),this.skillOptions.push(k),this.skillCardBgs.push(y)}this.selectedSkillIndex=0}showSkillPanel(){if(!this.skillManager.hasUpgradeableSkills()){console.log("All skills are maxed out!");return}this.createSkillOptions(),this.currentSkillChoices.length!==0&&(this.isPaused=!0,this.isMoving=!1,this.skillPanelContainer.setVisible(!0),this.selectedSkillIndex=0,this.skillCardBgs.forEach((t,e)=>{e===0?(t.setFillStyle(3355443),t.setStrokeStyle(3,16777215)):(t.setFillStyle(2236962),t.setStrokeStyle(2,6710886))}),this.skillPanelContainer.setAlpha(0),this.tweens.add({targets:this.skillPanelContainer,alpha:1,duration:200}),this.skillOptions.forEach((t,e)=>{t.setScale(e===0?1.05:1),t.setY(this.gameBounds.y+this.gameBounds.height*.55+50),t.setAlpha(0),this.tweens.add({targets:t,y:this.gameBounds.y+this.gameBounds.height*.55,alpha:1,duration:300,delay:e*100,ease:"Back.easeOut"})}))}hideSkillPanel(){this.tweens.add({targets:this.skillPanelContainer,alpha:0,duration:200,onComplete:()=>{this.skillPanelContainer.setVisible(!1),this.isPaused=!1}})}selectSkill(t,e){if(!this.skillManager.learnOrUpgradeSkill(e)){console.warn(`Failed to learn/upgrade skill: ${e}`);return}const i=this.skillManager.getPlayerSkill(e);console.log(`Skill upgraded: ${e} -> Lv.${i==null?void 0:i.level}`),this.updateSkillBarDisplay(),(i==null?void 0:i.definition.type)==="passive"&&(this.recalculateMaxHp(),this.recalculateMoveSpeed(),this.drawHpBarFill(),this.updateHpText(),console.log(`Passive skill effect applied. MaxHP: ${this.maxHp}, MoveSpeed: ${this.moveSpeed}`));const a=this.skillOptions[t];this.tweens.add({targets:a,scaleX:1.1,scaleY:1.1,duration:100,yoyo:!0,onComplete:()=>{this.hideSkillPanel()}})}};o(g,"MAP_SCALE",10),o(g,"BASE_ICON_SIZE",100),o(g,"BASE_ICON_GAP",10),o(g,"BASE_GROUP_GAP",30),o(g,"BASE_BOTTOM_MARGIN",20),o(g,"ACTIVE_SKILLS",4),o(g,"PASSIVE_SKILLS",3),o(g,"BASE_WIDTH",1920),o(g,"CAMERA_DEAD_ZONE",.3),o(g,"BASE_HP",20),o(g,"HP_PER_LEVEL",5),o(g,"BASE_EXP",100),o(g,"EXP_GROWTH_RATE",1.2);let R=g;const N=7,U={0:{width:5,pixels:[" ### ","#   #","#  ##","# # #","##  #","#   #"," ### "]},1:{width:3,pixels:[" # ","## "," # "," # "," # "," # ","###"]},2:{width:5,pixels:[" ### ","#   #","    #","  ## "," #   ","#    ","#####"]},3:{width:5,pixels:[" ### ","#   #","    #","  ## ","    #","#   #"," ### "]},4:{width:5,pixels:["#   #","#   #","#   #","#####","    #","    #","    #"]},5:{width:5,pixels:["#####","#    ","#    ","#### ","    #","#   #"," ### "]},6:{width:5,pixels:[" ### ","#    ","#    ","#### ","#   #","#   #"," ### "]},7:{width:5,pixels:["#####","    #","   # ","  #  ","  #  ","  #  ","  #  "]},8:{width:5,pixels:[" ### ","#   #","#   #"," ### ","#   #","#   #"," ### "]},9:{width:5,pixels:[" ### ","#   #","#   #"," ####","    #","    #"," ### "]},A:{width:5,pixels:[" ### ","#   #","#   #","#####","#   #","#   #","#   #"]},D:{width:5,pixels:["#### ","#   #","#   #","#   #","#   #","#   #","#### "]},E:{width:4,pixels:["####","#   ","#   ","### ","#   ","#   ","####"]},G:{width:5,pixels:[" ### ","#    ","#    ","# ###","#   #","#   #"," ### "]},I:{width:3,pixels:["###"," # "," # "," # "," # "," # ","###"]},L:{width:4,pixels:["#   ","#   ","#   ","#   ","#   ","#   ","####"]},N:{width:5,pixels:["#   #","##  #","# # #","#  ##","#   #","#   #","#   #"]},O:{width:5,pixels:[" ### ","#   #","#   #","#   #","#   #","#   #"," ### "]},P:{width:4,pixels:["### ","#  #","#  #","### ","#   ","#   ","#   "]},R:{width:4,pixels:["### ","#  #","#  #","### ","# # ","#  #","#  #"]},S:{width:4,pixels:[" ###","#   ","#   "," ## ","   #","   #","### "]},T:{width:5,pixels:["#####","  #  ","  #  ","  #  ","  #  ","  #  ","  #  "]},"%":{width:5,pixels:["##  #","## # ","  #  "," #   "," # ##","#  ##","   ##"]}," ":{width:3,pixels:["   ","   ","   ","   ","   ","   ","   "]}},V={charHeight:N,chars:U};class Z{constructor(){o(this,"font");this.font=V}textToPixels(r,t,e){const s=[],i=r.letterSpacing??1,a=r.color.replace("#",""),l=parseInt(a.substring(0,2),16),h=parseInt(a.substring(2,4),16),d=parseInt(a.substring(4,6),16),c=l<<16|h<<8|d;let p=0;const n=r.text.toUpperCase().split("");for(let y=0;y<n.length;y++){const u=this.font.chars[n[y]];u&&(p+=u.width,y<n.length-1&&(p+=i))}const m=Math.floor(t*r.position.x),S=Math.floor(e*r.position.y),x=m-Math.floor(p/2),f=S-Math.floor(this.font.charHeight/2);let k=x;for(const y of n){const u=this.font.chars[y];if(u){for(let M=0;M<u.pixels.length;M++){const E=u.pixels[M];for(let w=0;w<E.length;w++)if(E[w]==="#"){const v=k+w,B=f+M;v>=0&&v<t&&B>=0&&B<e&&s.push({gridX:v,gridY:B,color:c})}}k+=u.width+i}}return s}processConfig(r,t,e){const s=new Map;for(const i of r.texts){const a=this.textToPixels(i,t,e);s.set(i.id,a)}return s}}const J=[{id:"title",text:"PRESS TO START",letterSpacing:2,position:{x:.5,y:.5},color:"#ffffff"}],q={texts:J},I=class I extends C.Scene{constructor(){super("GridScene");o(this,"cells",[]);o(this,"cols",0);o(this,"rows",0);o(this,"cellWidth",10);o(this,"cellHeight",10);o(this,"gap",1);o(this,"isAnimating",!1);o(this,"isReady",!1);o(this,"textRenderer");o(this,"textPixels",new Map);o(this,"cursorGlowRadius",4);o(this,"glowPhase",0);o(this,"textBreathPhase",0);o(this,"isLoading",!0);o(this,"loadingCells",new Set);o(this,"backgroundImage");this.textRenderer=new Z}preload(){this.load.image("background","background.png"),this.load.image("char_idle","sprites/character/IDEL01.png"),this.load.image("char_run_1","sprites/character/RUN01.png"),this.load.image("char_run_2","sprites/character/RUN02.png"),this.load.image("char_attack_1","sprites/character/ATTACK01.png"),this.load.image("char_attack_2","sprites/character/ATTACK02.png"),this.load.image("char_hurt","sprites/character/HURT01.png"),this.load.on("progress",t=>{this.updateLoadingProgress(Math.floor(t*100))})}create(){this.cameras.main.setBackgroundColor("rgba(0,0,0,0)"),this.createBackground(),this.calculateGridSize(),this.createGrid(),this.showLoadingText(0),this.startEntryAnimation(),this.preloadGameAssets(),this.input.on("pointerdown",t=>{if(!this.isReady||this.isAnimating)return;const e=Math.floor(t.x/(this.cellWidth+this.gap)),s=Math.floor(t.y/(this.cellHeight+this.gap));this.startExitAnimation(e,s)}),this.input.on("pointermove",t=>{!this.isReady||this.isAnimating||this.updateCursorGlow(t.x,t.y)})}update(t,e){if(!this.isReady||this.isAnimating)return;this.glowPhase+=e*.002,this.textBreathPhase+=e*.004;const s=this.input.activePointer;s&&this.updateCursorGlow(s.x,s.y),this.updateTextBreath()}updateTextBreath(){const t=.5+.5*Math.sin(this.textBreathPhase),e=Math.floor(204+51*t),s=e<<16|e<<8|e,i=.5+.5*Math.sin(this.textBreathPhase*3),a=t>.6?i*.8:0,l=new Set;this.cells.forEach(h=>{h.isText&&l.add(`${h.x},${h.y}`)}),this.cells.forEach(h=>{if(h.isText)h.graphics.setFillStyle(s),h.graphics.setAlpha(.95);else{const d=`${h.x-1},${h.y-1}`;l.has(d)&&a>0&&(h.graphics.setFillStyle(8939263),h.graphics.setAlpha(a))}})}updateCursorGlow(t,e){const s=Math.floor(t/(this.cellWidth+this.gap)),i=Math.floor(e/(this.cellHeight+this.gap)),a=.3+.7*(.5+.5*Math.sin(this.glowPhase));this.cells.forEach(l=>{const h=l.x-s,d=l.y-i,c=Math.sqrt(h*h+d*d);if(c<=this.cursorGlowRadius){const n=(1-c/this.cursorGlowRadius)*a,m=l.originalColor>>16&255,S=l.originalColor>>8&255,x=l.originalColor&255,f=Math.min(255,Math.floor(m+(255-m)*n)),k=Math.min(255,Math.floor(S+(255-S)*n)),y=Math.min(255,Math.floor(x+(255-x)*n)),u=f<<16|k<<8|y;l.graphics.setFillStyle(u)}else l.graphics.setFillStyle(l.originalColor)})}createBackground(){const t=this.cameras.main.width,e=this.cameras.main.height;this.backgroundImage=this.add.image(t/2,e/2,"background");const s=t/this.backgroundImage.width,i=e/this.backgroundImage.height,a=Math.max(s,i);this.backgroundImage.setScale(a),this.backgroundImage.setDepth(-1)}showLoadingText(t){this.loadingCells.forEach(i=>{this.cells[i]&&(this.cells[i].originalColor=2236962,this.cells[i].isText=!1,this.cells[i].graphics.setFillStyle(2236962),this.cells[i].graphics.setAlpha(.2))}),this.loadingCells.clear();const e=`LOADING ${t}%`;this.textRenderer.textToPixels({id:"loading",text:e,letterSpacing:2,position:{x:.5,y:.5},color:"#ffffff"},this.cols,this.rows).forEach(i=>{const a=i.gridY*this.cols+i.gridX;this.cells[a]&&(this.cells[a].originalColor=i.color,this.cells[a].isText=!0,this.cells[a].graphics.setFillStyle(i.color),this.cells[a].graphics.setAlpha(.95),this.loadingCells.add(a))})}updateLoadingProgress(t){this.isLoading&&this.showLoadingText(t)}preloadGameAssets(){let t=0;const e=this.time.addEvent({delay:50,callback:()=>{t+=Math.random()*15,t>=100&&(t=100,e.destroy(),this.onLoadingComplete()),this.showLoadingText(Math.floor(t))},loop:!0})}onLoadingComplete(){this.isLoading=!1,this.time.delayedCall(500,()=>{this.cells.forEach(t=>{t.originalColor=2236962,t.isText=!1,t.graphics.setFillStyle(2236962),t.graphics.setAlpha(.2)}),this.loadingCells.clear(),this.time.delayedCall(300,()=>{this.processTextConfig(),this.textPixels.forEach(t=>{t.forEach(e=>{const s=e.gridY*this.cols+e.gridX;this.cells[s]&&(this.cells[s].graphics.setFillStyle(e.color),this.cells[s].graphics.setAlpha(.95))})}),this.isAnimating||(this.isReady=!0)})})}calculateGridSize(){const t=this.cameras.main.width,e=this.cameras.main.height,s=Math.min(1,t/I.BASE_WIDTH),i=Math.max(I.MIN_CELL_SIZE,Math.floor(I.BASE_CELL_SIZE*s));this.gap=1,this.cellWidth=i,this.cellHeight=i,this.cols=Math.ceil((t+this.gap)/(i+this.gap)),this.rows=Math.ceil((e+this.gap)/(i+this.gap));const a=.05,l=t*(1-a*2),h=e*(1-a*2),d=16/9,c=l/h;let p,n;c>d?(n=h,p=h*d):(p=l,n=l/d);const m=(t-p)/2,S=(e-n)/2;this.registry.set("gameBounds",{x:m,y:S,width:p,height:n}),console.log(`Grid: ${this.cols}x${this.rows}, cellSize: ${i}, gameBounds: ${p.toFixed(0)}x${n.toFixed(0)}`)}createGrid(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++){const s=e*(this.cellWidth+this.gap)+this.cellWidth/2,i=t*(this.cellHeight+this.gap)+this.cellHeight/2,a=this.add.rectangle(s,i,this.cellWidth,this.cellHeight,2236962);a.setAlpha(0),this.cells.push({x:e,y:t,graphics:a,delay:0,originalColor:2236962,isText:!1})}}processTextConfig(){this.textPixels=this.textRenderer.processConfig(q,this.cols,this.rows),this.textPixels.forEach(t=>{t.forEach(e=>{const s=e.gridY*this.cols+e.gridX;this.cells[s]&&(this.cells[s].originalColor=e.color,this.cells[s].isText=!0)})})}startEntryAnimation(){this.isAnimating=!0;const t=new Set;for(let f=0;f<this.cells.length;f++)t.add(f);const e=20,s=50,i=10,l=Math.floor(200/i),h=3e3;let d=0,c=!1;const p=(f,k)=>k*this.cols+f,n=f=>({x:f%this.cols,y:Math.floor(f/this.cols)}),m=f=>{const k=this.cells[f];k.graphics.setAlpha(1),k.graphics.setFillStyle(16777215),this.tweens.add({targets:k.graphics,fillColor:{from:16777215,to:k.originalColor},alpha:{from:1,to:.2},duration:80,ease:"Linear"})},S=f=>{const{x:k,y}=n(f),u=l,M=[];for(let v=0;v<=u;v++)M[v]=[];for(let v=-u;v<=u;v++)for(let B=-u;B<=u;B++){const A=k+B,P=y+v;if(A>=0&&A<this.cols&&P>=0&&P<this.rows){const b=Math.sqrt(B*B+v*v),T=Math.floor(b);if(T<=u){const F=p(A,P);M[T].push(F)}}}let E=0;const w=()=>{E>u||(M[E].forEach(v=>{t.has(v)&&(t.delete(v),m(v))}),E++,E<=u&&this.time.delayedCall(i,w))};w()},x=()=>{if(c)return;if(d>=h||t.size===0){this.finishEntry(t),c=!0;return}const f=Array.from(t),k=Math.min(e,f.length);for(let y=0;y<k&&f.length!==0;y++){const u=Math.floor(Math.random()*f.length),M=f[u];f.splice(u,1),t.has(M)&&S(M)}d+=s,t.size>0&&d<h?this.time.delayedCall(s,x):c||(this.finishEntry(t),c=!0)};x()}finishEntry(t){t.forEach(e=>{const s=this.cells[e];s.graphics.setAlpha(.2),s.graphics.setFillStyle(s.originalColor)}),this.time.delayedCall(100,()=>{this.isAnimating=!1,this.isLoading||(this.isReady=!0)})}startExitAnimation(t,e){this.isAnimating=!0;const s=this.cameras.main.width,i=this.cameras.main.height;this.scene.launch("MainScene"),this.scene.bringToTop("GridScene");const a=t*(this.cellWidth+this.gap)+this.cellWidth/2,l=e*(this.cellHeight+this.gap)+this.cellHeight/2;this.registry.events.emit("reveal-update",{x:a,y:l,radius:0}),this.cells.forEach(n=>{n.graphics.setFillStyle(0),n.graphics.setAlpha(1)}),this.backgroundImage.setVisible(!1);const h=5;let d=0;this.cells.forEach(n=>{const m=n.x-t,S=n.y-e,x=Math.sqrt(m*m+S*S);n.delay=Math.floor(x*h),n.delay>d&&(d=n.delay)});const c=Math.sqrt(Math.max(a,s-a)**2+Math.max(l,i-l)**2)+50,p=d+150;this.tweens.addCounter({from:0,to:c,duration:p,ease:"Linear",onUpdate:n=>{const m=n.getValue()??0;this.registry.events.emit("reveal-update",{x:a,y:l,radius:m})}}),this.cells.forEach(n=>{this.time.delayedCall(n.delay,()=>{n.graphics.setFillStyle(16777215),n.graphics.setAlpha(1),this.tweens.addCounter({from:0,to:100,duration:200,ease:"Linear",onUpdate:m=>{const S=m.getValue()??0;let x,f;S<15?(x=16777215,f=1):S<30?(x=16776960,f=1):S<50?(x=16746496,f=1):S<70?(x=16720384,f=1-(S-50)/50):(x=6684672,f=1-(S-50)/50),n.graphics.setFillStyle(x),n.graphics.setAlpha(Math.max(0,f))},onComplete:()=>{n.graphics.setVisible(!1)}})})}),this.time.delayedCall(d+200,()=>{this.registry.events.emit("reveal-complete"),this.scene.stop("GridScene")})}};o(I,"BASE_CELL_SIZE",10),o(I,"MIN_CELL_SIZE",4),o(I,"BASE_WIDTH",1920);let G=I,H=null;function j(){return window.innerWidth>window.innerHeight}function D(){return window.visualViewport?window.visualViewport.height:window.innerHeight}function Q(){if(H)return;const L={type:C.AUTO,width:window.innerWidth,height:D(),parent:"app",backgroundColor:"#111111",scale:{mode:C.Scale.RESIZE,autoCenter:C.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scene:[G,$,R]};H=new C.Game(L)}function _(){(window.innerWidth>900||j())&&Q()}_();window.addEventListener("resize",_);window.addEventListener("orientationchange",()=>{setTimeout(_,100)});window.visualViewport&&window.visualViewport.addEventListener("resize",()=>{H&&H.scale.resize(window.innerWidth,D())});document.addEventListener("fullscreenchange",()=>{H&&setTimeout(()=>{H.scale.resize(window.innerWidth,D())},100)});
