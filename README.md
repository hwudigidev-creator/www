# DDT Web Game

交互式網頁遊戲專案

**版本**: v0.1.0a（右下角顯示，由 package.json 自動注入）

## 技術棧

- **遊戲框架**: Phaser 3.80.0 (Arcade Physics)
- **語言**: TypeScript 5.2.2
- **構建工具**: Vite 5.0.0
- **模組系統**: ES Module

## 專案結構

```
src/
├── config/                 # 配置文件
│   ├── gridText.json           # 網格文字配置
│   └── pixelFont.json          # 像素字體定義 (A-Z, 0-9)
├── scenes/                 # Phaser 場景
│   ├── BootScene.ts            # 啟動場景
│   ├── GridScene.ts            # 網格過渡動畫場景
│   └── MainScene.ts            # 主遊戲場景
├── systems/                # 遊戲系統
│   ├── SkillSystem.ts          # 技能系統
│   └── MonsterSystem.ts        # 怪物系統
├── utils/                  # 工具函數
│   └── TextToGrid.ts           # 文字轉網格座標轉換器
└── main.ts                 # 應用入口點
public/
├── background.png          # 背景圖片
├── audio/                  # 背景音樂
│   ├── BGM00.mp3               # 標題畫面音樂
│   ├── BGM01.mp3               # 遊戲音樂 1
│   └── BGM02.mp3               # 遊戲音樂 2
└── sprites/
    └── character/          # 角色動畫序列圖
        ├── IDEL01.png          # 待機 1
        ├── IDEL02.png          # 待機 2
        ├── RUN01.png           # 跑步 1
        ├── RUN02.png           # 跑步 2
        ├── ATTACK01.png        # 攻擊 1
        ├── ATTACK02.png        # 攻擊 2
        └── HURT01.png          # 受傷
```

## 核心場景

### GridScene (網格過渡場景)

- 網格洪水填充進場動畫
- 圓形揭露 (Reveal Mask) 退出動畫
- 燃燒效果轉場 (白 → 黃 → 橘 → 紅 → 消失)
- Loading 進度顯示
- 像素字體文字渲染
- 游標互動光暈效果
- 標題 BGM 播放（BGM00，循環）

### BootScene (啟動場景)

- 過渡佔位場景
- 為資源預載預留

### MainScene (主遊戲場景)

- **地圖系統**: 10 倍大地圖，相機追蹤，30% 死區
- **角色系統**: Sprite 動畫（待機、跑步、攻擊、受傷），大小為遊戲區域 15%
- **角色控制**: 點擊/長按移動、WASD 鍵盤移動，基礎速度每秒 3 單位
- **技能欄**: 4 個主動技能 + 3 個被動技能
- **HP 條**: 暗紅暗紫流動漸層，顯示 當前/最大 HP
- **護盾條**: 金色流動漸層，顯示護盾值
- **經驗條**: 藍紫流動漸層動畫效果
- **技能選擇面板**: 升級時彈出，支持鍵盤 (A/S/D + W) 或點擊選擇
- **怪物系統**: 自動生成、追蹤玩家、造成傷害、血量隨等級成長
- **遊戲 BGM**: BGM01/02 隨機播放，播完自動切換

## 角色動畫

| 狀態 | 動畫 | 幀數 | FPS |
|------|------|------|-----|
| 待機 (idle) | char_idle | 2 | 2 |
| 跑步 (run) | char_run | 2 | 8 |
| 攻擊 (attack) | char_attack | 2 | 8 |
| 受傷 (hurt) | char_hurt | 1 | 2 |

## 傷害單位系統

- **1 傷害單位** = 10 點傷害
- **1 範圍單位** = 畫面高度 10%

## HP 系統

- **基礎 HP**: 200
- **每級成長**: +50 HP
- **升級時**: 自動回滿 HP
- **HP 條**: 技能欄上方，寬度與技能欄一致，高度為經驗條兩倍
- **受傷效果**: 角色閃淡紅白（80% 覆蓋）、HP 低於 30% 畫面邊緣紅暈閃爍

## 護盾系統

- **來源**: 架構師技能
- **護盾值**: 最大 HP 的 30%
- **效果**: 優先吸收傷害、反傷攻擊者
- **護盾破碎回血**: 護盾被打破時，恢復初始護盾等值的 HP
- **視覺**: 金色流動護盾條、受擊金色閃光

## 怪物系統

- **生成**: 每 2 秒從畫面外 3 個方向（上/左/右）隨機生成
- **移動**: 持續朝玩家位置移動，速度每秒 1.5 單位
- **攻擊**: 進入玩家 1 單位範圍內，每 3 秒造成傷害
- **傷害**: 玩家等級 × 1 傷害單位（最低 1 單位）
- **血量成長**: 每級 +10%
- **受傷硬直**: 玩家受傷後 200ms 無法移動
- **畫面震動**: 一次擊中 10 隻以上怪物時輕微震動

## 技能系統

### 技能類型

| 類型 | 數量 | 欄位位置 |
|------|------|----------|
| 攻擊型 (Active) | 4 個 | 左側 4 格 |
| 被動型 (Passive) | 3 個 | 右側 3 格 |

### 技能等級

- 等級範圍: 0 - 5（共 6 級）
- Lv.0 起即有效果
- 等級 5 顯示為 "MAX"
- 未擁有技能顯示為空
- **滿等所需等級**: 7 技能 × 6 級 = 42 級
- **技能全滿後**: 可繼續升級獲得 HP 成長，不再顯示技能選擇面板

### 技能選擇機制

- 第一次升級：只顯示 3 個攻擊技能（確保有傷害手段）
- 之後每次升級顯示 3 個選項: **2 攻擊 + 1 被動**
- 被動技能欄位上限 3 個，滿了只能升級已有技能
- 只有未滿級 (< MAX) 的技能會被隨機挑選
- 所有技能滿級後不再顯示選擇面板

### 攻擊技能

| 技能名稱 | 副標題 | 顏色 | 基礎冷卻 | 效果 |
|----------|--------|------|----------|------|
| 靈魂渲染 | 動畫大師 | 藍色 | 1 秒 | 扇形攻擊，3 單位範圍，每級 +10° 角度 +1 傷害（Lv.0=60°/2u, MAX=110°/7u）|
| 編碼者 | 遊戲先知 | 紫色 | 1.5 秒 | 圓形範圍攻擊，每級 +0.5 範圍 +1 傷害（Lv.0=2u/1u, MAX=4.5u/6u）|
| 視效師 | 超級導演 | 綠色 | 2.5 秒 | 貫穿光束，10 單位範圍，每級 +1 道光束 +1 傷害（Lv.0=1道/1u, MAX=6道/6u）|
| 架構師 | 靈魂統領 | 金色 | 10 秒 | 護盾（最大 HP 30%）+ 反傷，每級 +1.5 反傷（Lv.0=1u, MAX=8.5u），護盾破碎回血 |

- 技能自動發動（冷卻結束即發動）
- 發動時角色播放攻擊動畫 150ms 並閃爍對應顏色

### 被動技能

| 技能名稱 | 顏色 | 效果 | Lv.0 | Lv.5 (MAX) |
|----------|------|------|------|------------|
| 鈦金肝 | 銀灰色 | 每級 +10% HP | 10% | 60% |
| 精神同步率強化 | 暗橘色 | 每級 +10% 移速、-8% 冷卻 | 10% / 8% | 60% / 48% |
| 視網膜增強模組 | 螢光綠 | 每級 +30% 經驗 | 30% | 180% |
| AI賦能強化 | 粉紅色 | 每級 +25% 攻擊、+5% 防禦 | 25% / 5% | 150% / 30% |

## 音樂系統

- **標題畫面**: BGM00 循環播放
- **遊戲畫面**: BGM01/02 隨機播放，播完自動切換另一首
- **預設音量**: 50%

## UI 控制列

右上角控制列（轉場完成後顯示）：

- **全螢幕按鈕**: 點擊切換全螢幕模式
- **音量控制**: 直式排列，+/- 按鈕搭配 10 格音量指示條（支援長按），預設 50%

## 測試用快捷鍵

| 快捷鍵 | 功能 |
|--------|------|
| **+** | 增加 10 經驗（按住連續觸發）|
| **-** | 減少 10 經驗（按住連續觸發）|
| **Shift + +** | 直接升 1 級 |
| **Shift + 0** | 跳到 42 級，所有技能滿等 |
| **Ctrl + Shift + F5** | 靈魂渲染 MAX |
| **Ctrl + Shift + F6** | 編碼者 MAX |
| **Ctrl + Shift + F7** | 視效師 MAX |
| **Ctrl + Shift + F8** | 架構師 MAX |
| **Ctrl + Shift + F9** | 鈦金肝 MAX |
| **Ctrl + Shift + F10** | 精神同步率強化 MAX |
| **Ctrl + Shift + F11** | 視網膜增強模組 MAX |
| **Ctrl + Shift + F12** | AI賦能強化 MAX |

> 個別技能快捷鍵條件：技能未滿級，被動技能需欄位有空位

## 架構設計

### 響應式設計

- 基準寬度: 1920px
- 遊戲區域: 16:9 比例，置中顯示
- 所有元素動態縮放適配
- 使用 `dvh` 單位排除手機瀏覽器網址列
- 使用 `visualViewport` API 監聽視窗變化

### 手機支援

- 強制橫向模式（直向時顯示旋轉提示）
- 全螢幕 API 支援（含各瀏覽器前綴）
- 禁用觸控長按選單
- 長按移動支援

### 容器層級

```
uiContainer (固定 UI)
├── HP 條
├── 護盾條
├── 技能欄圖標
├── 經驗條
├── 技能選擇面板
└── 低血量紅暈效果

gameAreaContainer
├── boundsBorder (遊戲區域邊框)
└── worldContainer (隨相機移動)
    ├── floorGrid (格子背景)
    ├── character (Sprite 角色)
    └── monsters (怪物)
```

### 場景通信

- 使用 Phaser Registry 存儲全局狀態
- `reveal-update` 事件: GridScene → MainScene 同步揭露遮罩
- `reveal-complete` 事件: 過渡完成通知
- `volumechange` 自訂事件: HTML → 遊戲音量同步

## 開發命令

```bash
# 安裝依賴
npm install

# 啟動開發伺服器
npm run dev

# TypeScript 檢查 + 構建
npm run build

# 本地預覽構建結果
npm run preview

# 代碼檢查
npm run lint
```

## 構建配置

- **Base URL**: `/www/` (GitHub Pages)
- **Phaser 獨立打包**: 優化加載性能
- **資源不內聯**: 確保以文件形式加載

## 待開發功能

- [x] 技能實際效果（傷害怪物）
- [x] 怪物死亡和經驗掉落
- [ ] 遊戲結束畫面
- [ ] 本地存檔機制
- [ ] 更多怪物類型
