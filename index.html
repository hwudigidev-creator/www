<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <!-- Google Fonts: Noto Sans TC -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">

  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#111111" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="DIGI WAR" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="application-name" content="DIGI WAR" />
  <meta name="msapplication-TileColor" content="#111111" />
  <meta name="msapplication-tap-highlight" content="no" />

  <!-- PWA Manifest (ä½¿ç”¨ç›¸å°è·¯å¾‘æ”¯æ´ GitHub Pages å­ç›®éŒ„) -->
  <link rel="manifest" href="manifest.json" />

  <!-- Apple Touch Icons (ä½¿ç”¨ç›¸å°è·¯å¾‘) -->
  <link rel="apple-touch-icon" href="icons/icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="icons/icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="96x96" href="icons/icon-96x96.png" />
  <link rel="apple-touch-icon" sizes="128x128" href="icons/icon-128x128.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="icons/icon-144x144.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192x192.png" />
  <link rel="apple-touch-icon" sizes="384x384" href="icons/icon-384x384.png" />
  <link rel="apple-touch-icon" sizes="512x512" href="icons/icon-512x512.png" />

  <title>DIGI WAR</title>
  <style>
    * {
      margin: 0;
      padding: 0;
    }

    body {
      background-color: #111;
      overflow: hidden;
      /* ä½¿ç”¨ dvh æ’é™¤æ‰‹æ©Ÿç€è¦½å™¨ç¶²å€åˆ— */
      height: 100dvh;
      height: 100vh; /* fallback */
      width: 100vw;
      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
    }

    /* æ”¯æ´ dvh çš„ç€è¦½å™¨ */
    @supports (height: 100dvh) {
      body {
        height: 100dvh;
      }
    }

    #app {
      width: 100%;
      height: 100%;
    }

    /* å³ä¸Šè§’æ§åˆ¶åˆ— - ç›´å¼æ’åˆ— */
    #controls {
      position: fixed;
      top: 10px;
      right: 10px;
      display: none; /* é è¨­éš±è—ï¼Œè½‰å ´å¾Œæ‰é¡¯ç¤º */
      flex-direction: column;
      gap: 8px;
      z-index: 1000;
    }

    #controls.visible {
      display: flex;
    }

    .ctrl-btn {
      width: clamp(32px, 5vw, 44px);
      height: clamp(32px, 5vw, 44px);
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      color: #fff;
      font-size: clamp(14px, 2.5vw, 20px);
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: all 0.2s ease;
    }

    .ctrl-btn:hover {
      background: rgba(0, 0, 0, 0.8);
      border-color: rgba(255, 255, 255, 0.6);
    }

    .ctrl-btn:active {
      transform: scale(0.95);
    }

    /* æ§åˆ¶å€å…±ç”¨æ¨£å¼ - ç›´å¼æ’åˆ— */
    .control-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      width: clamp(32px, 5vw, 44px);
      box-sizing: border-box;
      padding: 6px 0;
      gap: 2px;
    }

    .control-btn {
      width: clamp(22px, 3.5vw, 30px);
      height: clamp(20px, 3vw, 26px);
      background: transparent;
      border: none;
      color: #fff;
      font-size: clamp(12px, 2vw, 16px);
      font-weight: bold;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: all 0.15s ease;
      border-radius: 4px;
    }

    .control-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .control-btn:active {
      transform: scale(0.9);
    }

    /* æ§åˆ¶å€æ•¸å€¼é¡¯ç¤º */
    .control-value {
      font-family: monospace;
      font-size: clamp(10px, 1.5vw, 14px);
      color: #fff;
      padding: 2px 0;
    }

    /* éŸ³é‡æ¢å®¹å™¨ */
    #volume-bars {
      display: flex;
      flex-direction: column-reverse;
      gap: 2px;
      padding: 2px 0;
    }

    .volume-bar {
      width: clamp(16px, 2.5vw, 22px);
      height: clamp(3px, 0.5vw, 5px);
      background: rgba(255, 255, 255, 0.25);
      border-radius: 2px;
      transition: background 0.1s ease;
    }

    .volume-bar.active {
      background: #fff;
    }

    .volume-bar.muted {
      background: rgba(255, 255, 255, 0.1);
    }

    /* å…¨è¢å¹•æ™‚æ”¹è®Šåœ–ç¤º */
    body.is-fullscreen #fullscreen-btn .expand-icon {
      display: none;
    }
    body.is-fullscreen #fullscreen-btn .compress-icon {
      display: block;
    }
    body:not(.is-fullscreen) #fullscreen-btn .expand-icon {
      display: block;
    }
    body:not(.is-fullscreen) #fullscreen-btn .compress-icon {
      display: none;
    }

    /* æ‰‹æ©Ÿç‰ˆéš±è—å…¨è¢å¹•æŒ‰éˆ• */
    @media screen and (max-width: 1024px) and (pointer: coarse) {
      #fullscreen-btn {
        display: none;
      }
    }

    /* å¼·åˆ¶æ©«å‘æç¤º */
    #rotate-notice {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #111;
      z-index: 9999;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      color: #fff;
      font-family: Arial, sans-serif;
    }

    #rotate-notice .icon {
      font-size: clamp(48px, 15vw, 80px);
      margin-bottom: 20px;
      animation: rotate-phone 1.5s ease-in-out infinite;
    }

    #rotate-notice .text {
      font-size: clamp(14px, 4vw, 24px);
    }

    @keyframes rotate-phone {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(-90deg); }
    }

    /* æ‰‹æ©Ÿç›´å‘æ™‚é¡¯ç¤ºæç¤º */
    @media screen and (max-width: 900px) and (orientation: portrait) {
      #rotate-notice {
        display: flex;
      }
      #app {
        display: none;
      }
      #controls {
        display: none;
      }
      #version-info {
        display: none;
      }
    }

    /* å³ä¸‹è§’ç‰ˆæœ¬è³‡è¨Š */
    #version-info {
      position: fixed;
      bottom: 10px;
      right: 10px;
      font-family: monospace;
      font-size: clamp(10px, 1.5vw, 14px);
      color: rgba(255, 255, 255, 0.3);
      z-index: 1000;
      pointer-events: none;
      user-select: none;
    }
  </style>
  <script type="module" crossorigin src="/www/assets/index-BBS5DP-d.js"></script>
  <link rel="modulepreload" crossorigin href="/www/assets/phaser-0RJB29YE.js">
</head>

<body>
  <div id="rotate-notice">
    <div class="icon">ğŸ“±</div>
    <div class="text">è«‹å°‡è£ç½®è½‰ç‚ºæ©«å‘</div>
  </div>

  <!-- å³ä¸‹è§’ç‰ˆæœ¬è³‡è¨Šï¼ˆç”± JS å‹•æ…‹è¨­å®šï¼‰ -->
  <div id="version-info"></div>

  <!-- å³ä¸Šè§’æ§åˆ¶åˆ—ï¼ˆé è¨­éš±è—ï¼Œè½‰å ´å¾Œé¡¯ç¤ºï¼‰ -->
  <div id="controls">
    <!-- é‡æ•´æŒ‰éˆ• -->
    <button id="reload-btn" class="ctrl-btn" title="é‡æ–°é–‹å§‹">â†»</button>
    <!-- ç¶²æ ¼å€ç‡æ§åˆ¶ -->
    <div id="grid-control" class="control-group" title="ç¶²æ ¼ç²¾ç´°åº¦">
      <button id="grid-up" class="control-btn">+</button>
      <span id="grid-value" class="control-value">3X</span>
      <button id="grid-down" class="control-btn">âˆ’</button>
    </div>
    <!-- å…¨è¢å¹•æŒ‰éˆ• -->
    <button id="fullscreen-btn" class="ctrl-btn" title="å…¨è¢å¹•">
      <span class="expand-icon">â›¶</span>
      <span class="compress-icon">â›¶</span>
    </button>
    <!-- éŸ³é‡æ§åˆ¶ -->
    <div id="volume-control" class="control-group" title="éŸ³é‡">
      <button id="volume-up" class="control-btn">+</button>
      <div id="volume-bars"></div>
      <button id="volume-down" class="control-btn">âˆ’</button>
    </div>
  </div>

  <div id="app"></div>

  <script>
    // ===== éŸ³é‡æ§åˆ¶ =====
    const volumeBars = document.getElementById('volume-bars');
    const volumeUp = document.getElementById('volume-up');
    const volumeDown = document.getElementById('volume-down');

    const VOLUME_LEVELS = 10;
    let currentVolume = 5; // 0-10ï¼Œé è¨­ 50%

    // å»ºç«‹ 10 å€‹éŸ³é‡æ¢
    for (let i = 0; i < VOLUME_LEVELS; i++) {
      const bar = document.createElement('div');
      bar.className = 'volume-bar';
      bar.dataset.level = i;
      volumeBars.appendChild(bar);
    }

    function updateVolumeBars() {
      const bars = volumeBars.querySelectorAll('.volume-bar');
      bars.forEach((bar, index) => {
        bar.classList.remove('active', 'muted');
        if (index < currentVolume) {
          bar.classList.add('active');
        }
      });
      // ç™¼é€éŸ³é‡è®Šæ›´äº‹ä»¶çµ¦éŠæˆ²
      window.dispatchEvent(new CustomEvent('volumechange', { detail: { volume: currentVolume / VOLUME_LEVELS } }));
    }

    // é•·æŒ‰æŒçºŒè§¸ç™¼
    let volumeInterval = null;
    const INITIAL_DELAY = 300; // é¦–æ¬¡è§¸ç™¼å¾Œçš„å»¶é²
    const REPEAT_DELAY = 100;  // æŒçºŒè§¸ç™¼çš„é–“éš”

    function startVolumeUp() {
      if (currentVolume < VOLUME_LEVELS) {
        currentVolume++;
        updateVolumeBars();
      }
    }

    function startVolumeDown() {
      if (currentVolume > 0) {
        currentVolume--;
        updateVolumeBars();
      }
    }

    function startHold(action) {
      action(); // ç«‹å³è§¸ç™¼ä¸€æ¬¡
      let firstTrigger = true;
      volumeInterval = setInterval(() => {
        if (firstTrigger) {
          firstTrigger = false;
          clearInterval(volumeInterval);
          volumeInterval = setInterval(action, REPEAT_DELAY);
        }
        action();
      }, INITIAL_DELAY);
    }

    function stopHold() {
      if (volumeInterval) {
        clearInterval(volumeInterval);
        volumeInterval = null;
      }
    }

    // æ»‘é¼ äº‹ä»¶
    volumeUp.addEventListener('mousedown', () => startHold(startVolumeUp));
    volumeUp.addEventListener('mouseup', stopHold);
    volumeUp.addEventListener('mouseleave', stopHold);

    volumeDown.addEventListener('mousedown', () => startHold(startVolumeDown));
    volumeDown.addEventListener('mouseup', stopHold);
    volumeDown.addEventListener('mouseleave', stopHold);

    // è§¸æ§äº‹ä»¶
    volumeUp.addEventListener('touchstart', (e) => {
      e.preventDefault();
      startHold(startVolumeUp);
    });
    volumeUp.addEventListener('touchend', stopHold);
    volumeUp.addEventListener('touchcancel', stopHold);

    volumeDown.addEventListener('touchstart', (e) => {
      e.preventDefault();
      startHold(startVolumeDown);
    });
    volumeDown.addEventListener('touchend', stopHold);
    volumeDown.addEventListener('touchcancel', stopHold);

    // åˆå§‹åŒ–
    updateVolumeBars();

    // ===== å…¨è¢å¹•åŠŸèƒ½ =====
    const fullscreenBtn = document.getElementById('fullscreen-btn');

    function isFullscreen() {
      return !!(document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement);
    }

    function updateFullscreenState() {
      if (isFullscreen()) {
        document.body.classList.add('is-fullscreen');
      } else {
        document.body.classList.remove('is-fullscreen');
      }
    }

    function toggleFullscreen() {
      if (!isFullscreen()) {
        const elem = document.documentElement;
        if (elem.requestFullscreen) {
          elem.requestFullscreen();
        } else if (elem.webkitRequestFullscreen) {
          elem.webkitRequestFullscreen();
        } else if (elem.mozRequestFullScreen) {
          elem.mozRequestFullScreen();
        } else if (elem.msRequestFullscreen) {
          elem.msRequestFullscreen();
        }
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.mozCancelFullScreen) {
          document.mozCancelFullScreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }
      }
    }

    fullscreenBtn.addEventListener('click', toggleFullscreen);

    document.addEventListener('fullscreenchange', updateFullscreenState);
    document.addEventListener('webkitfullscreenchange', updateFullscreenState);
    document.addEventListener('mozfullscreenchange', updateFullscreenState);
    document.addEventListener('MSFullscreenChange', updateFullscreenState);

    // ===== é‡æ•´æŒ‰éˆ• =====
    const reloadBtn = document.getElementById('reload-btn');
    reloadBtn.addEventListener('click', () => {
      location.reload();
    });

    // ===== ç¶²æ ¼å€ç‡æ§åˆ¶ =====
    const gridUp = document.getElementById('grid-up');
    const gridDown = document.getElementById('grid-down');
    const gridValue = document.getElementById('grid-value');
    // åˆ¤æ–·æ˜¯å¦ç‚ºæ‰‹æ©Ÿï¼ˆè§¸æ§è£ç½®ä¸”è¢å¹•è¼ƒå°ï¼‰
    const isMobileDevice = ('ontouchstart' in window) && window.innerWidth < 1024;
    let gridScale = isMobileDevice ? 2 : 3; // æ‰‹æ©Ÿé è¨­ 2Xï¼Œé›»è…¦é è¨­ 3X
    gridValue.textContent = `${gridScale}X`;

    function updateGridDisplay() {
      gridValue.textContent = `${gridScale}X`;
      window.dispatchEvent(new CustomEvent('gridscalechange', { detail: { scale: gridScale } }));
    }

    gridUp.addEventListener('click', () => {
      if (gridScale < 3) {
        gridScale++;
        updateGridDisplay();
      }
    });

    gridDown.addEventListener('click', () => {
      if (gridScale > 1) {
        gridScale--;
        updateGridDisplay();
      }
    });

    // ===== è¨»å†Š Service Worker =====
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        // ä½¿ç”¨ç›¸å°è·¯å¾‘ï¼Œæ”¯æ´ GitHub Pages å­ç›®éŒ„éƒ¨ç½²
        const swPath = new URL('sw.js', window.location.href).href;
        navigator.serviceWorker.register(swPath)
          .then((registration) => {
            console.log('[PWA] Service Worker registered:', registration.scope);
          })
          .catch((error) => {
            console.log('[PWA] Service Worker registration failed:', error);
          });
      });
    }
  </script>

</body>

</html>